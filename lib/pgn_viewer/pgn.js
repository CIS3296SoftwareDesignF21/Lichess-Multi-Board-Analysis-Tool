/*! For license information please see pgn.js.LICENSE.txt */
!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports["pgn-parser"]=n():t["pgn-parser"]=n()}(global,(function(){return(()=>{var t={586:function(t,n){var r,e;void 0===(e="function"==typeof(r=function(){"use strict";function t(n,r,e,o){var i=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(i,t.prototype),i.expected=r,i.found=e,i.location=o,i.name="SyntaxError",i}function n(t,n,r){return r=r||" ",t.length>n?t:(n-=t.length,t+(r+=r.repeat(n)).slice(0,n))}return function(t,n){function r(){this.constructor=t}r.prototype=n.prototype,t.prototype=new r}(t,Error),t.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var e,o=null;for(e=0;e<t.length;e++)if(t[e].source===this.location.source){o=t[e].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,u=this.location.source+":"+i.line+":"+i.column;if(o){var a=this.location.end,s=n("",i.line.toString().length),c=o[i.line-1],l=i.line===a.line?a.column:c.length+1;r+="\n --\x3e "+u+"\n"+s+" |\n"+i.line+" | "+c+"\n"+s+" | "+n("",i.column-1)+n("",l-i.column,"^")}else r+="\n at "+u}return r},t.buildMessage=function(t,n){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var n=t.parts.map((function(t){return Array.isArray(t)?i(t[0])+"-"+i(t[1]):i(t)}));return"["+(t.inverted?"^":"")+n+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+e(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+e(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+e(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+e(t)}))}function u(t){return r[t.type](t)}return"Expected "+function(t){var n,r,e=t.map(u);if(e.sort(),e.length>0){for(n=1,r=1;n<e.length;n++)e[n-1]!==e[n]&&(e[r]=e[n],r++);e.length=r}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(n)+" found."},{SyntaxError:t,parse:function(n,r){var e,o={},i=(r=void 0!==r?r:{}).grammarSource,u={pgn:Ea,tags:Mu,game:ju,games:function(){var t,n,r,e,i,u;if(t=_u,aa(),n=_u,(r=ju())!==o){for(e=[],i=_u,aa(),(u=ju())!==o?(Ou=i,i=mu(0,u)):(_u=i,i=o);i!==o;)e.push(i),i=_u,aa(),(u=ju())!==o?(Ou=i,i=mu(0,u)):(_u=i,i=o);Ou=n,n=[r].concat(e)}else _u=n,n=o;return n===o&&(n=null),Ou=t,t=n}},a=Ea,s="Event",c="event",l="Site",f="site",v="Date",p="date",h="Round",g="round",m="White",d="white",b="Black",A="black",C="Result",E="result",y="WhiteTitle",k="Whitetitle",S="whitetitle",T="whiteTitle",w="BlackTitle",x="Blacktitle",N="blacktitle",_="blackTitle",O="WhiteELO",R="WhiteElo",P="Whiteelo",B="whiteelo",U="whiteElo",D="BlackELO",L="BlackElo",I="Blackelo",W="blackelo",$="blackElo",F="WhiteUSCF",j="WhiteUscf",M="Whiteuscf",q="whiteuscf",Q="whiteUscf",G="BlackUSCF",K="BlackUscf",V="Blackuscf",H="blackuscf",z="blackUscf",Z="WhiteNA",Y="WhiteNa",X="Whitena",J="whitena",tt="whiteNa",nt="whiteNA",rt="BlackNA",et="BlackNa",ot="Blackna",it="blackna",ut="blackNA",at="blackNa",st="WhiteType",ct="Whitetype",lt="whitetype",ft="whiteType",vt="BlackType",pt="Blacktype",ht="blacktype",gt="blackType",mt="EventDate",dt="Eventdate",bt="eventdate",At="eventDate",Ct="EventSponsor",Et="Eventsponsor",yt="eventsponsor",kt="eventSponsor",St="Section",Tt="section",wt="Stage",xt="stage",Nt="Board",_t="board",Ot="Opening",Rt="opening",Pt="Variation",Bt="variation",Ut="SubVariation",Dt="Subvariation",Lt="subvariation",It="subVariation",Wt="ECO",$t="Eco",Ft="eco",jt="NIC",Mt="Nic",qt="nic",Qt="Time",Gt="time",Kt="UTCTime",Vt="UTCtime",Ht="UtcTime",zt="Utctime",Zt="utctime",Yt="utcTime",Xt="UTCDate",Jt="UTCdate",tn="UtcDate",nn="Utcdate",rn="utcdate",en="utcDate",on="TimeControl",un="Timecontrol",an="timecontrol",sn="timeControl",cn="SetUp",ln="Setup",fn="setup",vn="setUp",pn="FEN",hn="Fen",gn="fen",mn="Termination",dn="termination",bn="Annotator",An="annotator",Cn="Mode",En="mode",yn="PlyCount",kn="Plycount",Sn="plycount",Tn="plyCount",wn="Variant",xn="variant",Nn="WhiteRatingDiff",_n="BlackRatingDiff",On="WhiteFideId",Rn="BlackFideId",Pn="WhiteTeam",Bn="BlackTeam",Un="Clock",Dn="WhiteClock",Ln="BlackClock",In=".",Wn=":",$n="/",Fn="?",jn="-",Mn="1/2-1/2",qn="%csl",Qn="%cal",Gn="%eval",Kn=",",Vn="clk",Hn="egt",zn="emt",Zn="mct",Yn="O-O-O",Xn="O-O",Jn="+-",tr="!!",nr="??",rr="!?",er="?!",or="-+",ir=/^[ \t\n\r]/,ur=/^[\n\r]/,ar=/^[\-a-zA-Z0-9.]/,sr=/^[0-9?]/,cr=/^[0-9]/,lr=/^[^\n\r]/,fr=/^[RNBQKP]/,vr=/^[RNBQ]/,pr=/^[a-h]/,hr=/^[1-8]/,gr=Du("Event",!1),mr=Du("event",!1),dr=Du("Site",!1),br=Du("site",!1),Ar=Du("Date",!1),Cr=Du("date",!1),Er=Du("Round",!1),yr=Du("round",!1),kr=Du("White",!1),Sr=Du("white",!1),Tr=Du("Black",!1),wr=Du("black",!1),xr=Du("Result",!1),Nr=Du("result",!1),_r=Du("WhiteTitle",!1),Or=Du("Whitetitle",!1),Rr=Du("whitetitle",!1),Pr=Du("whiteTitle",!1),Br=Du("BlackTitle",!1),Ur=Du("Blacktitle",!1),Dr=Du("blacktitle",!1),Lr=Du("blackTitle",!1),Ir=Du("WhiteELO",!1),Wr=Du("WhiteElo",!1),$r=Du("Whiteelo",!1),Fr=Du("whiteelo",!1),jr=Du("whiteElo",!1),Mr=Du("BlackELO",!1),qr=Du("BlackElo",!1),Qr=Du("Blackelo",!1),Gr=Du("blackelo",!1),Kr=Du("blackElo",!1),Vr=Du("WhiteUSCF",!1),Hr=Du("WhiteUscf",!1),zr=Du("Whiteuscf",!1),Zr=Du("whiteuscf",!1),Yr=Du("whiteUscf",!1),Xr=Du("BlackUSCF",!1),Jr=Du("BlackUscf",!1),te=Du("Blackuscf",!1),ne=Du("blackuscf",!1),re=Du("blackUscf",!1),ee=Du("WhiteNA",!1),oe=Du("WhiteNa",!1),ie=Du("Whitena",!1),ue=Du("whitena",!1),ae=Du("whiteNa",!1),se=Du("whiteNA",!1),ce=Du("BlackNA",!1),le=Du("BlackNa",!1),fe=Du("Blackna",!1),ve=Du("blackna",!1),pe=Du("blackNA",!1),he=Du("blackNa",!1),ge=Du("WhiteType",!1),me=Du("Whitetype",!1),de=Du("whitetype",!1),be=Du("whiteType",!1),Ae=Du("BlackType",!1),Ce=Du("Blacktype",!1),Ee=Du("blacktype",!1),ye=Du("blackType",!1),ke=Du("EventDate",!1),Se=Du("Eventdate",!1),Te=Du("eventdate",!1),we=Du("eventDate",!1),xe=Du("EventSponsor",!1),Ne=Du("Eventsponsor",!1),_e=Du("eventsponsor",!1),Oe=Du("eventSponsor",!1),Re=Du("Section",!1),Pe=Du("section",!1),Be=Du("Stage",!1),Ue=Du("stage",!1),De=Du("Board",!1),Le=Du("board",!1),Ie=Du("Opening",!1),We=Du("opening",!1),$e=Du("Variation",!1),Fe=Du("variation",!1),je=Du("SubVariation",!1),Me=Du("Subvariation",!1),qe=Du("subvariation",!1),Qe=Du("subVariation",!1),Ge=Du("ECO",!1),Ke=Du("Eco",!1),Ve=Du("eco",!1),He=Du("NIC",!1),ze=Du("Nic",!1),Ze=Du("nic",!1),Ye=Du("Time",!1),Xe=Du("time",!1),Je=Du("UTCTime",!1),to=Du("UTCtime",!1),no=Du("UtcTime",!1),ro=Du("Utctime",!1),eo=Du("utctime",!1),oo=Du("utcTime",!1),io=Du("UTCDate",!1),uo=Du("UTCdate",!1),ao=Du("UtcDate",!1),so=Du("Utcdate",!1),co=Du("utcdate",!1),lo=Du("utcDate",!1),fo=Du("TimeControl",!1),vo=Du("Timecontrol",!1),po=Du("timecontrol",!1),ho=Du("timeControl",!1),go=Du("SetUp",!1),mo=Du("Setup",!1),bo=Du("setup",!1),Ao=Du("setUp",!1),Co=Du("FEN",!1),Eo=Du("Fen",!1),yo=Du("fen",!1),ko=Du("Termination",!1),So=Du("termination",!1),To=Du("Annotator",!1),wo=Du("annotator",!1),xo=Du("Mode",!1),No=Du("mode",!1),_o=Du("PlyCount",!1),Oo=Du("Plycount",!1),Ro=Du("plycount",!1),Po=Du("plyCount",!1),Bo=Du("Variant",!1),Uo=Du("variant",!1),Do=Du("WhiteRatingDiff",!1),Lo=Du("BlackRatingDiff",!1),Io=Du("WhiteFideId",!1),Wo=Du("BlackFideId",!1),$o=Du("WhiteTeam",!1),Fo=Du("BlackTeam",!1),jo=Du("Clock",!1),Mo=Du("WhiteClock",!1),qo=Du("BlackClock",!1),Qo=Iu("whitespace"),Go=Lu([" ","\t","\n","\r"],!1,!1),Ko=Lu(["\n","\r"],!1,!1),Vo=Iu("string"),Ho=Lu(["-",["a","z"],["A","Z"],["0","9"],"."],!1,!1),zo=Du('"',!1),Zo={type:"any"},Yo=Lu([["0","9"],"?"],!1,!1),Xo=Du(".",!1),Jo=Lu([["0","9"]],!1,!1),ti=Du(":",!1),ni=Du("/",!1),ri=Du("B",!1),ei=Du("W",!1),oi=Du("N",!1),ii=Du("?",!1),ui=Du("-",!1),ai=Du("+",!1),si=Du("*",!1),ci=Du("1-0",!1),li=Du("0-1",!1),fi=Du("1/2-1/2",!1),vi=Du("%csl",!1),pi=Du("%cal",!1),hi=Du("%",!1),gi=Du("%eval",!1),mi=Du("[%",!1),di=Du("}",!1),bi=Lu(["\n","\r"],!0,!1),Ai=Du(",",!1),Ci=Du("Y",!1),Ei=Du("G",!1),yi=Du("R",!1),ki=Du("{",!1),Si=Du("[",!1),Ti=Du("]",!1),wi=Du(";",!1),xi=Du("clk",!1),Ni=Du("egt",!1),_i=Du("emt",!1),Oi=Du("mct",!1),Ri=Du("(",!1),Pi=Du(")",!1),Bi=Iu("integer"),Ui=Du(" ",!1),Di=Du("O-O-O",!1),Li=Du("O-O",!1),Ii=Du("@",!1),Wi=Du("+-",!1),$i=Du("$$$",!1),Fi=Du("#",!1),ji=Du("=",!1),Mi=Du("$",!1),qi=Du("!!",!1),Qi=Du("??",!1),Gi=Du("!?",!1),Ki=Du("?!",!1),Vi=Du("!",!1),Hi=Du("‼",!1),zi=Du("⁇",!1),Zi=Du("⁉",!1),Yi=Du("⁈",!1),Xi=Du("□",!1),Ji=Du("∞",!1),tu=Du("⩲",!1),nu=Du("⩱",!1),ru=Du("±",!1),eu=Du("∓",!1),ou=Du("-+",!1),iu=Du("⨀",!1),uu=Du("⟳",!1),au=Du("→",!1),su=Du("↑",!1),cu=Du("⇆",!1),lu=Du("D",!1),fu=Lu(["R","N","B","Q","K","P"],!1,!1),vu=Lu(["R","N","B","Q"],!1,!1),pu=Lu([["a","h"]],!1,!1),hu=Lu([["1","8"]],!1,!1),gu=Du("x",!1),mu=function(t,n){return n},du=function(t){return t.join("")},bu=function(t){return Za(t)},Au=function(t,n){return n},Cu=function(t,n){return n},Eu=function(t,n){return n},yu=function(t,n,r){return r},ku=function(t,n,r){var e={};return e[t]=n,Xa([e].concat(r[0]))},Su=function(t,n){return n},Tu=function(t,n,r){return r},wu=function(t,n){return n},xu=function(t,n){var r=[];r.push(t);for(var e=0;e<n.length;e++)r.push(n[e][2]);return r},Nu=function(t){return t[1]},_u=0,Ou=0,Ru=[{line:1,column:1}],Pu=0,Bu=[],Uu=0;if("startRule"in r){if(!(r.startRule in u))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=u[r.startRule]}function Du(t,n){return{type:"literal",text:t,ignoreCase:n}}function Lu(t,n,r){return{type:"class",parts:t,inverted:n,ignoreCase:r}}function Iu(t){return{type:"other",description:t}}function Wu(t){var r,e=Ru[t];if(e)return e;for(r=t-1;!Ru[r];)r--;for(e={line:(e=Ru[r]).line,column:e.column};r<t;)10===n.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return Ru[t]=e,e}function $u(t,n){var r=Wu(t),e=Wu(n);return{source:i,start:{offset:t,line:r.line,column:r.column},end:{offset:n,line:e.line,column:e.column}}}function Fu(t){_u<Pu||(_u>Pu&&(Pu=_u,Bu=[]),Bu.push(t))}function ju(){var t,n,r,e,i;return t=_u,n=Mu(),(r=ya())===o&&(r=null),(e=Ea())!==o?(Ou=t,i=Ha,Ha=[],t={tags:n,gameComment:r,moves:e,messages:i}):(_u=t,t=o),t}function Mu(){var t,n,r,e,i,u,a,s;if(t=_u,aa(),n=_u,(r=qu())!==o){for(e=[],i=_u,aa(),(u=qu())!==o?(Ou=i,i=mu(0,u)):(_u=i,i=o);i!==o;)e.push(i),i=_u,aa(),(u=qu())!==o?(Ou=i,i=mu(0,u)):(_u=i,i=o);Ou=n,a={},[r].concat(e).forEach((function(t){a[t.name]=t.value})),n=a}else _u=n,n=o;return n===o&&(n=null),r=aa(),Ou=t,null===(s=n)?{}:(s.messages=Ha,s)}function qu(){var t,r;return t=_u,Ra()!==o?(aa(),(r=function(){var t,r,e,i,u;return t=_u,(r=function(){var t;return n.substr(_u,5)===s?(t=s,_u+=5):(t=o,0===Uu&&Fu(gr)),t===o&&(n.substr(_u,5)===c?(t=c,_u+=5):(t=o,0===Uu&&Fu(mr))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,a=i,t={name:"Event",value:a}):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,4)===l?(t=l,_u+=4):(t=o,0===Uu&&Fu(dr)),t===o&&(n.substr(_u,4)===f?(t=f,_u+=4):(t=o,0===Uu&&Fu(br))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Site",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Gu())!==o?(e=aa(),(i=pa())!==o?(Ou=t,t=function(t){return{name:"Date",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,5)===h?(t=h,_u+=5):(t=o,0===Uu&&Fu(Er)),t===o&&(n.substr(_u,5)===g?(t=g,_u+=5):(t=o,0===Uu&&Fu(yr))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Round",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,10)===y?(t=y,_u+=10):(t=o,0===Uu&&Fu(_r)),t===o&&(n.substr(_u,10)===k?(t=k,_u+=10):(t=o,0===Uu&&Fu(Or)),t===o&&(n.substr(_u,10)===S?(t=S,_u+=10):(t=o,0===Uu&&Fu(Rr)),t===o&&(n.substr(_u,10)===T?(t=T,_u+=10):(t=o,0===Uu&&Fu(Pr))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"WhiteTitle",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,10)===w?(t=w,_u+=10):(t=o,0===Uu&&Fu(Br)),t===o&&(n.substr(_u,10)===x?(t=x,_u+=10):(t=o,0===Uu&&Fu(Ur)),t===o&&(n.substr(_u,10)===N?(t=N,_u+=10):(t=o,0===Uu&&Fu(Dr)),t===o&&(n.substr(_u,10)===_?(t=_,_u+=10):(t=o,0===Uu&&Fu(Lr))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"BlackTitle",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Vu())!==o?(e=aa(),(i=Aa())!==o?(Ou=t,t=function(t){return{name:"WhiteElo",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Hu())!==o?(e=aa(),(i=Aa())!==o?(Ou=t,t=function(t){return{name:"BlackElo",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=zu())!==o?(e=aa(),(i=Ca())!==o?(Ou=t,t=function(t){return{name:"WhiteUSCF",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Zu())!==o?(e=aa(),(i=Ca())!==o?(Ou=t,t=function(t){return{name:"BlackUSCF",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,7)===Z?(t=Z,_u+=7):(t=o,0===Uu&&Fu(ee)),t===o&&(n.substr(_u,7)===Y?(t=Y,_u+=7):(t=o,0===Uu&&Fu(oe)),t===o&&(n.substr(_u,7)===X?(t=X,_u+=7):(t=o,0===Uu&&Fu(ie)),t===o&&(n.substr(_u,7)===J?(t=J,_u+=7):(t=o,0===Uu&&Fu(ue)),t===o&&(n.substr(_u,7)===tt?(t=tt,_u+=7):(t=o,0===Uu&&Fu(ae)),t===o&&(n.substr(_u,7)===nt?(t=nt,_u+=7):(t=o,0===Uu&&Fu(se))))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"WhiteNA",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,7)===rt?(t=rt,_u+=7):(t=o,0===Uu&&Fu(ce)),t===o&&(n.substr(_u,7)===et?(t=et,_u+=7):(t=o,0===Uu&&Fu(le)),t===o&&(n.substr(_u,7)===ot?(t=ot,_u+=7):(t=o,0===Uu&&Fu(fe)),t===o&&(n.substr(_u,7)===it?(t=it,_u+=7):(t=o,0===Uu&&Fu(ve)),t===o&&(n.substr(_u,7)===ut?(t=ut,_u+=7):(t=o,0===Uu&&Fu(pe)),t===o&&(n.substr(_u,7)===at?(t=at,_u+=7):(t=o,0===Uu&&Fu(he))))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"BlackNA",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,9)===st?(t=st,_u+=9):(t=o,0===Uu&&Fu(ge)),t===o&&(n.substr(_u,9)===ct?(t=ct,_u+=9):(t=o,0===Uu&&Fu(me)),t===o&&(n.substr(_u,9)===lt?(t=lt,_u+=9):(t=o,0===Uu&&Fu(de)),t===o&&(n.substr(_u,9)===ft?(t=ft,_u+=9):(t=o,0===Uu&&Fu(be))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"WhiteType",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,9)===vt?(t=vt,_u+=9):(t=o,0===Uu&&Fu(Ae)),t===o&&(n.substr(_u,9)===pt?(t=pt,_u+=9):(t=o,0===Uu&&Fu(Ce)),t===o&&(n.substr(_u,9)===ht?(t=ht,_u+=9):(t=o,0===Uu&&Fu(Ee)),t===o&&(n.substr(_u,9)===gt?(t=gt,_u+=9):(t=o,0===Uu&&Fu(ye))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"BlackType",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,5)===m?(t=m,_u+=5):(t=o,0===Uu&&Fu(kr)),t===o&&(n.substr(_u,5)===d?(t=d,_u+=5):(t=o,0===Uu&&Fu(Sr))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"White",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,5)===b?(t=b,_u+=5):(t=o,0===Uu&&Fu(Tr)),t===o&&(n.substr(_u,5)===A?(t=A,_u+=5):(t=o,0===Uu&&Fu(wr))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Black",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Ku())!==o?(e=aa(),(i=function(){var t,n;return t=_u,fa()!==o&&(n=ba())!==o&&fa()!==o?(Ou=t,t=n):(_u=t,t=o),t}())!==o?(Ou=t,t=function(t){return{name:"Result",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Yu())!==o?(e=aa(),(i=pa())!==o?(Ou=t,t=function(t){return{name:"EventDate",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,12)===Ct?(t=Ct,_u+=12):(t=o,0===Uu&&Fu(xe)),t===o&&(n.substr(_u,12)===Et?(t=Et,_u+=12):(t=o,0===Uu&&Fu(Ne)),t===o&&(n.substr(_u,12)===yt?(t=yt,_u+=12):(t=o,0===Uu&&Fu(_e)),t===o&&(n.substr(_u,12)===kt?(t=kt,_u+=12):(t=o,0===Uu&&Fu(Oe))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"EventSponsor",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,7)===St?(t=St,_u+=7):(t=o,0===Uu&&Fu(Re)),t===o&&(n.substr(_u,7)===Tt?(t=Tt,_u+=7):(t=o,0===Uu&&Fu(Pe))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Section",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,5)===wt?(t=wt,_u+=5):(t=o,0===Uu&&Fu(Be)),t===o&&(n.substr(_u,5)===xt?(t=xt,_u+=5):(t=o,0===Uu&&Fu(Ue))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Stage",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Xu())!==o?(e=aa(),(i=Ca())!==o?(Ou=t,t=function(t){return{name:"Board",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,7)===Ot?(t=Ot,_u+=7):(t=o,0===Uu&&Fu(Ie)),t===o&&(n.substr(_u,7)===Rt?(t=Rt,_u+=7):(t=o,0===Uu&&Fu(We))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Opening",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,9)===Pt?(t=Pt,_u+=9):(t=o,0===Uu&&Fu($e)),t===o&&(n.substr(_u,9)===Bt?(t=Bt,_u+=9):(t=o,0===Uu&&Fu(Fe))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Variation",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,12)===Ut?(t=Ut,_u+=12):(t=o,0===Uu&&Fu(je)),t===o&&(n.substr(_u,12)===Dt?(t=Dt,_u+=12):(t=o,0===Uu&&Fu(Me)),t===o&&(n.substr(_u,12)===Lt?(t=Lt,_u+=12):(t=o,0===Uu&&Fu(qe)),t===o&&(n.substr(_u,12)===It?(t=It,_u+=12):(t=o,0===Uu&&Fu(Qe))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"SubVariation",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,3)===Wt?(t=Wt,_u+=3):(t=o,0===Uu&&Fu(Ge)),t===o&&(n.substr(_u,3)===$t?(t=$t,_u+=3):(t=o,0===Uu&&Fu(Ke)),t===o&&(n.substr(_u,3)===Ft?(t=Ft,_u+=3):(t=o,0===Uu&&Fu(Ve)))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"ECO",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,3)===jt?(t=jt,_u+=3):(t=o,0===Uu&&Fu(He)),t===o&&(n.substr(_u,3)===Mt?(t=Mt,_u+=3):(t=o,0===Uu&&Fu(ze)),t===o&&(n.substr(_u,3)===qt?(t=qt,_u+=3):(t=o,0===Uu&&Fu(Ze)))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"NIC",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Ju())!==o?(e=aa(),(i=ha())!==o?(Ou=t,t=function(t){return{name:"Time",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=ta())!==o?(e=aa(),(i=ha())!==o?(Ou=t,t=function(t){return{name:"UTCTime",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=na())!==o?(e=aa(),(i=pa())!==o?(Ou=t,t=function(t){return{name:"UTCDate",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=ra())!==o?(e=aa(),(i=function(){var t,r;return t=_u,fa()!==o&&(r=function(){var t,r,e,i;return t=_u,63===n.charCodeAt(_u)?(r="?",_u++):(r=o,0===Uu&&Fu(ii)),r!==o&&(Ou=t,r={kind:"unknown",value:"?"}),(t=r)===o&&(t=_u,45===n.charCodeAt(_u)?(r=jn,_u++):(r=o,0===Uu&&Fu(ui)),r!==o&&(Ou=t,r={kind:"unlimited",value:"-"}),(t=r)===o&&(t=_u,(r=Wa())!==o?(47===n.charCodeAt(_u)?(e="/",_u++):(e=o,0===Uu&&Fu(ni)),e!==o&&(i=Wa())!==o?(Ou=t,u=r,a=i,t={kind:"movesInSeconds",moves:u,seconds:a}):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Wa())!==o?(43===n.charCodeAt(_u)?(e="+",_u++):(e=o,0===Uu&&Fu(ai)),e!==o&&(i=Wa())!==o?(Ou=t,t=function(t,n){return{kind:"increment",seconds:t,increment:n}}(r,i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Wa())!==o&&(Ou=t,r=function(t){return{kind:"suddenDeath",seconds:t}}(r)),(t=r)===o&&(t=_u,42===n.charCodeAt(_u)?(r="*",_u++):(r=o,0===Uu&&Fu(si)),r!==o&&(e=Wa())!==o?(Ou=t,t=function(t){return{kind:"hourglass",seconds:t}}(e)):(_u=t,t=o)))))),t;var u,a}())!==o&&fa()!==o?(Ou=t,t=r):(_u=t,t=o),t}())!==o?(Ou=t,t=function(t){return{name:"TimeControl",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,5)===cn?(t=cn,_u+=5):(t=o,0===Uu&&Fu(go)),t===o&&(n.substr(_u,5)===ln?(t=ln,_u+=5):(t=o,0===Uu&&Fu(mo)),t===o&&(n.substr(_u,5)===fn?(t=fn,_u+=5):(t=o,0===Uu&&Fu(bo)),t===o&&(n.substr(_u,5)===vn?(t=vn,_u+=5):(t=o,0===Uu&&Fu(Ao))))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"SetUp",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,3)===pn?(t=pn,_u+=3):(t=o,0===Uu&&Fu(Co)),t===o&&(n.substr(_u,3)===hn?(t=hn,_u+=3):(t=o,0===Uu&&Fu(Eo)),t===o&&(n.substr(_u,3)===gn?(t=gn,_u+=3):(t=o,0===Uu&&Fu(yo)))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"FEN",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,11)===mn?(t=mn,_u+=11):(t=o,0===Uu&&Fu(ko)),t===o&&(n.substr(_u,11)===dn?(t=dn,_u+=11):(t=o,0===Uu&&Fu(So))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Termination",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,9)===bn?(t=bn,_u+=9):(t=o,0===Uu&&Fu(To)),t===o&&(n.substr(_u,9)===An?(t=An,_u+=9):(t=o,0===Uu&&Fu(wo))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Annotator",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,4)===Cn?(t=Cn,_u+=4):(t=o,0===Uu&&Fu(xo)),t===o&&(n.substr(_u,4)===En?(t=En,_u+=4):(t=o,0===Uu&&Fu(No))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Mode",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=ea())!==o?(e=aa(),(i=Ca())!==o?(Ou=t,t=function(t){return{name:"PlyCount",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,7)===wn?(t=wn,_u+=7):(t=o,0===Uu&&Fu(Bo)),t===o&&(n.substr(_u,7)===xn?(t=xn,_u+=7):(t=o,0===Uu&&Fu(Uo))),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"Variant",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,15)===Nn?(t=Nn,_u+=15):(t=o,0===Uu&&Fu(Do)),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"WhiteRatingDiff",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,15)===_n?(t=_n,_u+=15):(t=o,0===Uu&&Fu(Lo)),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"BlackRatingDiff",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,11)===On?(t=On,_u+=11):(t=o,0===Uu&&Fu(Io)),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"WhiteFideId",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,11)===Rn?(t=Rn,_u+=11):(t=o,0===Uu&&Fu(Wo)),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"BlackFideId",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,9)===Pn?(t=Pn,_u+=9):(t=o,0===Uu&&Fu($o)),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"WhiteTeam",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t;return n.substr(_u,9)===Bn?(t=Bn,_u+=9):(t=o,0===Uu&&Fu(Fo)),t}())!==o?(e=aa(),(i=ca())!==o?(Ou=t,t=function(t){return{name:"BlackTeam",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=oa())!==o?(e=aa(),(i=function(){var t,r;return t=_u,fa()!==o&&(r=function(){var t,r,e,i;return t=_u,(r=function(){var t;return 66===n.charCodeAt(_u)?(t="B",_u++):(t=o,0===Uu&&Fu(ri)),t===o&&(87===n.charCodeAt(_u)?(t="W",_u++):(t=o,0===Uu&&Fu(ei)),t===o&&(78===n.charCodeAt(_u)?(t="N",_u++):(t=o,0===Uu&&Fu(oi)))),t}())!==o?(47===n.charCodeAt(_u)?(e=$n,_u++):(e=o,0===Uu&&Fu(ni)),e!==o&&(i=da())!==o?(Ou=t,u=r,a=i,t=u+"/"+a):(_u=t,t=o)):(_u=t,t=o),t;var u,a}())!==o&&fa()!==o?(Ou=t,t=r):(_u=t,t=o),t}())!==o?(Ou=t,t=function(t){return{name:"Clock",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=ia())!==o?(e=aa(),(i=ma())!==o?(Ou=t,t=function(t){return{name:"WhiteClock",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=ua())!==o?(e=aa(),(i=ma())!==o?(Ou=t,t=function(t){return{name:"BlackClock",value:t}}(i)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,r=_u,Uu++,e=Qu(),Uu--,e!==o?(_u=r,r=void 0):r=o,r!==o?(e=la(),i=aa(),(u=ca())!==o?(Ou=t,t=function(t,n){return za({key:t,value:n,message:`Format of tag: "${t}" not correct: "${n}"`}),{name:t,value:n}}(e,u)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,r=_u,Uu++,e=Qu(),Uu--,e===o?r=void 0:(_u=r,r=o),r!==o?(e=la(),i=aa(),(u=ca())!==o?(Ou=t,t=function(t,n){return za({key:t,value:n,message:`Tag: "${t}" not known: "${n}"`}),{name:t,value:n}}(e,u)):(_u=t,t=o)):(_u=t,t=o))))))))))))))))))))))))))))))))))))))))))))))))),t;var a}())!==o?(aa(),Pa()!==o?(Ou=t,t=r):(_u=t,t=o)):(_u=t,t=o)):(_u=t,t=o),t}function Qu(){var t;return(t=Gu())===o&&(t=Vu())===o&&(t=Hu())===o&&(t=zu())===o&&(t=Zu())===o&&(t=Ku())===o&&(t=Yu())===o&&(t=Xu())===o&&(t=Ju())===o&&(t=ta())===o&&(t=na())===o&&(t=ra())===o&&(t=ea())===o&&(t=oa())===o&&(t=ia())===o&&(t=ua()),t}function Gu(){var t;return n.substr(_u,4)===v?(t=v,_u+=4):(t=o,0===Uu&&Fu(Ar)),t===o&&(n.substr(_u,4)===p?(t=p,_u+=4):(t=o,0===Uu&&Fu(Cr))),t}function Ku(){var t;return n.substr(_u,6)===C?(t=C,_u+=6):(t=o,0===Uu&&Fu(xr)),t===o&&(n.substr(_u,6)===E?(t=E,_u+=6):(t=o,0===Uu&&Fu(Nr))),t}function Vu(){var t;return n.substr(_u,8)===O?(t=O,_u+=8):(t=o,0===Uu&&Fu(Ir)),t===o&&(n.substr(_u,8)===R?(t=R,_u+=8):(t=o,0===Uu&&Fu(Wr)),t===o&&(n.substr(_u,8)===P?(t=P,_u+=8):(t=o,0===Uu&&Fu($r)),t===o&&(n.substr(_u,8)===B?(t=B,_u+=8):(t=o,0===Uu&&Fu(Fr)),t===o&&(n.substr(_u,8)===U?(t=U,_u+=8):(t=o,0===Uu&&Fu(jr)))))),t}function Hu(){var t;return n.substr(_u,8)===D?(t=D,_u+=8):(t=o,0===Uu&&Fu(Mr)),t===o&&(n.substr(_u,8)===L?(t=L,_u+=8):(t=o,0===Uu&&Fu(qr)),t===o&&(n.substr(_u,8)===I?(t=I,_u+=8):(t=o,0===Uu&&Fu(Qr)),t===o&&(n.substr(_u,8)===W?(t=W,_u+=8):(t=o,0===Uu&&Fu(Gr)),t===o&&(n.substr(_u,8)===$?(t=$,_u+=8):(t=o,0===Uu&&Fu(Kr)))))),t}function zu(){var t;return n.substr(_u,9)===F?(t=F,_u+=9):(t=o,0===Uu&&Fu(Vr)),t===o&&(n.substr(_u,9)===j?(t=j,_u+=9):(t=o,0===Uu&&Fu(Hr)),t===o&&(n.substr(_u,9)===M?(t=M,_u+=9):(t=o,0===Uu&&Fu(zr)),t===o&&(n.substr(_u,9)===q?(t=q,_u+=9):(t=o,0===Uu&&Fu(Zr)),t===o&&(n.substr(_u,9)===Q?(t=Q,_u+=9):(t=o,0===Uu&&Fu(Yr)))))),t}function Zu(){var t;return n.substr(_u,9)===G?(t=G,_u+=9):(t=o,0===Uu&&Fu(Xr)),t===o&&(n.substr(_u,9)===K?(t=K,_u+=9):(t=o,0===Uu&&Fu(Jr)),t===o&&(n.substr(_u,9)===V?(t=V,_u+=9):(t=o,0===Uu&&Fu(te)),t===o&&(n.substr(_u,9)===H?(t=H,_u+=9):(t=o,0===Uu&&Fu(ne)),t===o&&(n.substr(_u,9)===z?(t=z,_u+=9):(t=o,0===Uu&&Fu(re)))))),t}function Yu(){var t;return n.substr(_u,9)===mt?(t=mt,_u+=9):(t=o,0===Uu&&Fu(ke)),t===o&&(n.substr(_u,9)===dt?(t=dt,_u+=9):(t=o,0===Uu&&Fu(Se)),t===o&&(n.substr(_u,9)===bt?(t=bt,_u+=9):(t=o,0===Uu&&Fu(Te)),t===o&&(n.substr(_u,9)===At?(t=At,_u+=9):(t=o,0===Uu&&Fu(we))))),t}function Xu(){var t;return n.substr(_u,5)===Nt?(t=Nt,_u+=5):(t=o,0===Uu&&Fu(De)),t===o&&(n.substr(_u,5)===_t?(t=_t,_u+=5):(t=o,0===Uu&&Fu(Le))),t}function Ju(){var t;return n.substr(_u,4)===Qt?(t=Qt,_u+=4):(t=o,0===Uu&&Fu(Ye)),t===o&&(n.substr(_u,4)===Gt?(t=Gt,_u+=4):(t=o,0===Uu&&Fu(Xe))),t}function ta(){var t;return n.substr(_u,7)===Kt?(t=Kt,_u+=7):(t=o,0===Uu&&Fu(Je)),t===o&&(n.substr(_u,7)===Vt?(t=Vt,_u+=7):(t=o,0===Uu&&Fu(to)),t===o&&(n.substr(_u,7)===Ht?(t=Ht,_u+=7):(t=o,0===Uu&&Fu(no)),t===o&&(n.substr(_u,7)===zt?(t=zt,_u+=7):(t=o,0===Uu&&Fu(ro)),t===o&&(n.substr(_u,7)===Zt?(t=Zt,_u+=7):(t=o,0===Uu&&Fu(eo)),t===o&&(n.substr(_u,7)===Yt?(t=Yt,_u+=7):(t=o,0===Uu&&Fu(oo))))))),t}function na(){var t;return n.substr(_u,7)===Xt?(t=Xt,_u+=7):(t=o,0===Uu&&Fu(io)),t===o&&(n.substr(_u,7)===Jt?(t=Jt,_u+=7):(t=o,0===Uu&&Fu(uo)),t===o&&(n.substr(_u,7)===tn?(t=tn,_u+=7):(t=o,0===Uu&&Fu(ao)),t===o&&(n.substr(_u,7)===nn?(t=nn,_u+=7):(t=o,0===Uu&&Fu(so)),t===o&&(n.substr(_u,7)===rn?(t=rn,_u+=7):(t=o,0===Uu&&Fu(co)),t===o&&(n.substr(_u,7)===en?(t=en,_u+=7):(t=o,0===Uu&&Fu(lo))))))),t}function ra(){var t;return n.substr(_u,11)===on?(t=on,_u+=11):(t=o,0===Uu&&Fu(fo)),t===o&&(n.substr(_u,11)===un?(t=un,_u+=11):(t=o,0===Uu&&Fu(vo)),t===o&&(n.substr(_u,11)===an?(t=an,_u+=11):(t=o,0===Uu&&Fu(po)),t===o&&(n.substr(_u,11)===sn?(t=sn,_u+=11):(t=o,0===Uu&&Fu(ho))))),t}function ea(){var t;return n.substr(_u,8)===yn?(t=yn,_u+=8):(t=o,0===Uu&&Fu(_o)),t===o&&(n.substr(_u,8)===kn?(t=kn,_u+=8):(t=o,0===Uu&&Fu(Oo)),t===o&&(n.substr(_u,8)===Sn?(t=Sn,_u+=8):(t=o,0===Uu&&Fu(Ro)),t===o&&(n.substr(_u,8)===Tn?(t=Tn,_u+=8):(t=o,0===Uu&&Fu(Po))))),t}function oa(){var t;return n.substr(_u,5)===Un?(t=Un,_u+=5):(t=o,0===Uu&&Fu(jo)),t}function ia(){var t;return n.substr(_u,10)===Dn?(t=Dn,_u+=10):(t=o,0===Uu&&Fu(Mo)),t}function ua(){var t;return n.substr(_u,10)===Ln?(t=Ln,_u+=10):(t=o,0===Uu&&Fu(qo)),t}function aa(){var t,r;for(Uu++,t=[],ir.test(n.charAt(_u))?(r=n.charAt(_u),_u++):(r=o,0===Uu&&Fu(Go));r!==o;)t.push(r),ir.test(n.charAt(_u))?(r=n.charAt(_u),_u++):(r=o,0===Uu&&Fu(Go));return Uu--,r=o,0===Uu&&Fu(Qo),t}function sa(){var t,r;if(t=[],ir.test(n.charAt(_u))?(r=n.charAt(_u),_u++):(r=o,0===Uu&&Fu(Go)),r!==o)for(;r!==o;)t.push(r),ir.test(n.charAt(_u))?(r=n.charAt(_u),_u++):(r=o,0===Uu&&Fu(Go));else t=o;return t}function ca(){var t,n,r;if(Uu++,t=_u,fa()!==o){for(n=[],r=va();r!==o;)n.push(r),r=va();(r=fa())!==o?(Ou=t,t=du(n)):(_u=t,t=o)}else _u=t,t=o;return Uu--,t===o&&0===Uu&&Fu(Vo),t}function la(){var t,r,e;for(t=_u,r=[],ar.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Ho));e!==o;)r.push(e),ar.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Ho));return Ou=t,du(r)}function fa(){var t;return 34===n.charCodeAt(_u)?(t='"',_u++):(t=o,0===Uu&&Fu(zo)),t}function va(){var t,r,e;return t=_u,r=_u,Uu++,e=fa(),Uu--,e===o?r=void 0:(_u=r,r=o),r!==o?(n.length>_u?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Zo)),e!==o?(Ou=t,t=e):(_u=t,t=o)):(_u=t,t=o),t}function pa(){var t,r,e,i,u,a,s,c,l,f,v;return t=_u,fa()!==o?(r=_u,sr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Yo)),e!==o?(sr.test(n.charAt(_u))?(i=n.charAt(_u),_u++):(i=o,0===Uu&&Fu(Yo)),i!==o?(sr.test(n.charAt(_u))?(u=n.charAt(_u),_u++):(u=o,0===Uu&&Fu(Yo)),u!==o?(sr.test(n.charAt(_u))?(a=n.charAt(_u),_u++):(a=o,0===Uu&&Fu(Yo)),a!==o?r=e=[e,i,u,a]:(_u=r,r=o)):(_u=r,r=o)):(_u=r,r=o)):(_u=r,r=o),r!==o?(46===n.charCodeAt(_u)?(e=In,_u++):(e=o,0===Uu&&Fu(Xo)),e!==o?(i=_u,sr.test(n.charAt(_u))?(u=n.charAt(_u),_u++):(u=o,0===Uu&&Fu(Yo)),u!==o?(sr.test(n.charAt(_u))?(a=n.charAt(_u),_u++):(a=o,0===Uu&&Fu(Yo)),a!==o?i=u=[u,a]:(_u=i,i=o)):(_u=i,i=o),i!==o?(46===n.charCodeAt(_u)?(u=In,_u++):(u=o,0===Uu&&Fu(Xo)),u!==o?(a=_u,sr.test(n.charAt(_u))?(s=n.charAt(_u),_u++):(s=o,0===Uu&&Fu(Yo)),s!==o?(sr.test(n.charAt(_u))?(c=n.charAt(_u),_u++):(c=o,0===Uu&&Fu(Yo)),c!==o?a=s=[s,c]:(_u=a,a=o)):(_u=a,a=o),a!==o&&(s=fa())!==o?(Ou=t,f=i,v=a,t={value:(l=r).join("")+"."+f.join("")+"."+v.join(""),year:Ya(l),month:Ya(f),day:Ya(v)}):(_u=t,t=o)):(_u=t,t=o)):(_u=t,t=o)):(_u=t,t=o)):(_u=t,t=o)):(_u=t,t=o),t}function ha(){var t,r,e,i,u,a,s;if(t=_u,fa()!==o){if(r=[],cr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Jo)),e!==o)for(;e!==o;)r.push(e),cr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Jo));else r=o;if(r!==o)if(58===n.charCodeAt(_u)?(e=Wn,_u++):(e=o,0===Uu&&Fu(ti)),e!==o){if(i=[],cr.test(n.charAt(_u))?(u=n.charAt(_u),_u++):(u=o,0===Uu&&Fu(Jo)),u!==o)for(;u!==o;)i.push(u),cr.test(n.charAt(_u))?(u=n.charAt(_u),_u++):(u=o,0===Uu&&Fu(Jo));else i=o;if(i!==o)if(58===n.charCodeAt(_u)?(u=Wn,_u++):(u=o,0===Uu&&Fu(ti)),u!==o){if(a=[],cr.test(n.charAt(_u))?(s=n.charAt(_u),_u++):(s=o,0===Uu&&Fu(Jo)),s!==o)for(;s!==o;)a.push(s),cr.test(n.charAt(_u))?(s=n.charAt(_u),_u++):(s=o,0===Uu&&Fu(Jo));else a=o;a!==o?((s=ga())===o&&(s=null),fa()!==o?(Ou=t,t=function(t,n,r,e){let o=t.join("")+":"+n.join("")+":"+r.join("");return e&&(o=o+"."+e,za({message:`Unusual use of millis in time: ${o}`}),Ya(e)),{value:o,hour:Ya(t),minute:Ya(n),second:Ya(r),millis:0}}(r,i,a,s)):(_u=t,t=o)):(_u=t,t=o)}else _u=t,t=o;else _u=t,t=o}else _u=t,t=o;else _u=t,t=o}else _u=t,t=o;return t}function ga(){var t,r,e,i;if(t=_u,46===n.charCodeAt(_u)?(r=In,_u++):(r=o,0===Uu&&Fu(Xo)),r!==o){if(e=[],cr.test(n.charAt(_u))?(i=n.charAt(_u),_u++):(i=o,0===Uu&&Fu(Jo)),i!==o)for(;i!==o;)e.push(i),cr.test(n.charAt(_u))?(i=n.charAt(_u),_u++):(i=o,0===Uu&&Fu(Jo));else e=o;e!==o?(Ou=t,t=e.join("")):(_u=t,t=o)}else _u=t,t=o;return t}function ma(){var t,n;return t=_u,fa()!==o&&(n=da())!==o&&fa()!==o?(Ou=t,t=n):(_u=t,t=o),t}function da(){var t,n;return t=_u,(n=Ba())!==o&&(Ou=t,n=n),n}function ba(){var t,r;return t=_u,"1-0"===n.substr(_u,3)?(r="1-0",_u+=3):(r=o,0===Uu&&Fu(ci)),r!==o&&(Ou=t,r=r),(t=r)===o&&(t=_u,"0-1"===n.substr(_u,3)?(r="0-1",_u+=3):(r=o,0===Uu&&Fu(li)),r!==o&&(Ou=t,r=r),(t=r)===o&&(t=_u,n.substr(_u,7)===Mn?(r=Mn,_u+=7):(r=o,0===Uu&&Fu(fi)),r!==o&&(Ou=t,r=r),(t=r)===o&&(t=_u,42===n.charCodeAt(_u)?(r="*",_u++):(r=o,0===Uu&&Fu(si)),r!==o&&(Ou=t,r=r),t=r))),t}function Aa(){var t,r,e,i;return(t=Ca())===o&&(t=_u,(r=fa())!==o?(45===n.charCodeAt(_u)?(e=jn,_u++):(e=o,0===Uu&&Fu(ui)),e!==o&&(i=fa())!==o?t=r=[r,e,i]:(_u=t,t=o)):(_u=t,t=o)),t}function Ca(){var t,r,e;if(t=_u,fa()!==o){if(r=[],cr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Jo)),e!==o)for(;e!==o;)r.push(e),cr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Jo));else r=o;r!==o&&(e=fa())!==o?(Ou=t,t=bu(r)):(_u=t,t=o)}else _u=t,t=o;return t}function Ea(){var t,r,e,i,u,a,s,c,l,f,v,p,h,g,m;return t=_u,aa(),(r=ya())===o&&(r=null),aa(),(e=function(){var t,n,r,e,i;if(t=_u,(n=Wa())!==o){for(r=[],e=$a();e!==o;)r.push(e),e=$a();for(e=[],i=Ia();i!==o;)e.push(i),i=Ia();Ou=t,t=n}else _u=t,t=o;return t}())===o&&(e=null),aa(),(i=function(){var t,r,e,i,u,a,s,c,l;return t=_u,(r=Qa())===o&&(r=null),e=_u,Uu++,i=function(){var t,n,r,e,i;return t=_u,(n=qa())!==o?((r=Va())===o&&(r=null),(e=Ga())!==o&&(i=Ka())!==o?t=n=[n,r,e,i]:(_u=t,t=o)):(_u=t,t=o),t}(),Uu--,i!==o?(_u=e,e=void 0):e=o,e!==o&&(i=qa())!==o?((u=Va())===o&&(u=null),(a=Ga())!==o&&(s=Ka())!==o?((c=ja())===o&&(c=null),(l=Fa())===o&&(l=null),Ou=t,f=r,v=i,p=u,h=a,g=s,m=c,d=l,b={},b.fig=f||null,b.disc=v||null,b.strike=p||null,b.col=h,b.row=g,b.check=d||null,b.promotion=m,b.notation=(f||"")+(v||"")+(p||"")+h+g+(m||"")+(d||""),t=b):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Qa())===o&&(r=null),(e=Ga())!==o&&(i=Ka())!==o?((u=function(){var t;return 120===n.charCodeAt(_u)?(t="x",_u++):(t=o,0===Uu&&Fu(gu)),t===o&&(45===n.charCodeAt(_u)?(t=jn,_u++):(t=o,0===Uu&&Fu(ui))),t}())===o&&(u=null),(a=Ga())!==o&&(s=Ka())!==o?((c=ja())===o&&(c=null),(l=Fa())===o&&(l=null),Ou=t,t=function(t,n,r,e,o,i,u,a){var s={};return s.fig=t||null,s.strike="x"==e?e:null,s.col=o,s.row=i,s.notation=(t&&"P"!==t?t:"")+n+r+("x"==e?e:"-")+o+i+(u||"")+(a||""),s.check=a||null,s.promotion=u,s}(r,e,i,u,a,s,c,l)):(_u=t,t=o)):(_u=t,t=o),t===o&&(t=_u,(r=Qa())===o&&(r=null),(e=Va())===o&&(e=null),(i=Ga())!==o&&(u=Ka())!==o?((a=ja())===o&&(a=null),(s=Fa())===o&&(s=null),Ou=t,t=function(t,n,r,e,o,i){var u={};return u.fig=t||null,u.strike=n||null,u.col=r,u.row=e,u.check=i||null,u.promotion=o,u.notation=(t||"")+(n||"")+r+e+(o||"")+(i||""),u}(r,e,i,u,a,s)):(_u=t,t=o),t===o&&(t=_u,n.substr(_u,5)===Yn?(r=Yn,_u+=5):(r=o,0===Uu&&Fu(Di)),r!==o?((e=Fa())===o&&(e=null),Ou=t,t=function(t){var n={};return n.notation="O-O-O"+(t||""),n.check=t||null,n}(e)):(_u=t,t=o),t===o&&(t=_u,n.substr(_u,3)===Xn?(r=Xn,_u+=3):(r=o,0===Uu&&Fu(Li)),r!==o?((e=Fa())===o&&(e=null),Ou=t,t=function(t){var n={};return n.notation="O-O"+(t||""),n.check=t||null,n}(e)):(_u=t,t=o),t===o&&(t=_u,(r=Qa())!==o?(64===n.charCodeAt(_u)?(e="@",_u++):(e=o,0===Uu&&Fu(Ii)),e!==o&&(i=Ga())!==o&&(u=Ka())!==o?(Ou=t,t=function(t,n,r){var e={};return e.fig=t,e.drop=!0,e.col=n,e.row=r,e.notation=t+"@"+n+r,e}(r,i,u)):(_u=t,t=o)):(_u=t,t=o)))))),t;var f,v,p,h,g,m,d,b}())!==o?(aa(),(u=Ma())===o&&(u=null),aa(),(a=ya())===o&&(a=null),aa(),(s=La())===o&&(s=null),(c=Ea())===o&&(c=null),Ou=t,l=r,f=i,v=u,p=a,h=s,g=c||[],(m={}).moveNumber=e,m.notation=f,p&&(m.commentAfter=p.comment),l&&(m.commentMove=l.comment),m.variations=h||[],m.nag=v||null,g.unshift(m),m.commentDiag=p,t=g):(_u=t,t=o),t===o&&(t=_u,aa(),(r=function(){var t,n;return t=_u,(n=ba())!==o&&(Ou=t,r=n,n=[r]),n;var r}())!==o?(aa(),Ou=t,t=r):(_u=t,t=o)),t}function ya(){var t,n,r,e,i;if(t=_u,(n=ka())!==o){for(r=[],e=_u,aa(),(i=ka())!==o?(Ou=e,e=Au(0,i)):(_u=e,e=o);e!==o;)r.push(e),e=_u,aa(),(i=ka())!==o?(Ou=e,e=Au(0,i)):(_u=e,e=o);Ou=t,t=Xa([n].concat(r))}else _u=t,t=o;return t}function ka(){var t,r,e;return t=_u,(r=function(){var t;return 123===n.charCodeAt(_u)?(t="{",_u++):(t=o,0===Uu&&Fu(ki)),t}())!==o&&(e=Sa())!==o&&function(){var t;return 125===n.charCodeAt(_u)?(t="}",_u++):(t=o,0===Uu&&Fu(di)),t}()!==o?(Ou=t,t=e):(_u=t,t=o),t===o&&(t=_u,(r=function(){var t,r,e;if(t=_u,function(){var t;return 59===n.charCodeAt(_u)?(t=";",_u++):(t=o,0===Uu&&Fu(wi)),t}()!==o){for(r=[],lr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(bi));e!==o;)r.push(e),lr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(bi));(e=function(){var t,r;if(t=[],ur.test(n.charAt(_u))?(r=n.charAt(_u),_u++):(r=o,0===Uu&&Fu(Ko)),r!==o)for(;r!==o;)t.push(r),ur.test(n.charAt(_u))?(r=n.charAt(_u),_u++):(r=o,0===Uu&&Fu(Ko));else t=o;return t}())!==o?(Ou=t,t=r.join("")):(_u=t,t=o)}else _u=t,t=o;return t}())!==o&&(Ou=t,r={comment:r}),t=r),t}function Sa(){var t,r,e,i,u,a,s,c,l,f,v,p;if(t=_u,r=aa(),(e=Ra())!==o)if(n.substr(_u,4)===qn?(i=qn,_u+=4):(i=o,0===Uu&&Fu(vi)),i!==o)if((u=sa())!==o)if((a=function(){var t,r,e,i,u,a,s;if(t=_u,(r=xa())!==o){for(aa(),e=[],i=_u,44===n.charCodeAt(_u)?(u=Kn,_u++):(u=o,0===Uu&&Fu(Ai)),u!==o?(a=aa(),(s=xa())!==o?i=u=[u,a,s]:(_u=i,i=o)):(_u=i,i=o);i!==o;)e.push(i),i=_u,44===n.charCodeAt(_u)?(u=Kn,_u++):(u=o,0===Uu&&Fu(Ai)),u!==o?(a=aa(),(s=xa())!==o?i=u=[u,a,s]:(_u=i,i=o)):(_u=i,i=o);Ou=t,t=xu(r,e)}else _u=t,t=o;return t}())!==o)if(s=aa(),(c=Pa())!==o){for(aa(),l=[],f=_u,(v=Sa())!==o&&(Ou=f,v=Cu(0,v)),f=v;f!==o;)l.push(f),f=_u,(v=Sa())!==o&&(Ou=f,v=Cu(0,v)),f=v;Ou=t,t=Xa([{colorFields:a}].concat(l[0]))}else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;if(t===o){if(t=_u,r=aa(),(e=Ra())!==o)if(n.substr(_u,4)===Qn?(i=Qn,_u+=4):(i=o,0===Uu&&Fu(pi)),i!==o)if((u=sa())!==o)if((a=function(){var t,r,e,i,u,a,s;if(t=_u,(r=Na())!==o){for(aa(),e=[],i=_u,44===n.charCodeAt(_u)?(u=Kn,_u++):(u=o,0===Uu&&Fu(Ai)),u!==o?(a=aa(),(s=Na())!==o?i=u=[u,a,s]:(_u=i,i=o)):(_u=i,i=o);i!==o;)e.push(i),i=_u,44===n.charCodeAt(_u)?(u=Kn,_u++):(u=o,0===Uu&&Fu(Ai)),u!==o?(a=aa(),(s=Na())!==o?i=u=[u,a,s]:(_u=i,i=o)):(_u=i,i=o);Ou=t,t=xu(r,e)}else _u=t,t=o;return t}())!==o)if(s=aa(),(c=Pa())!==o){for(aa(),l=[],f=_u,(v=Sa())!==o&&(Ou=f,v=Eu(0,v)),f=v;f!==o;)l.push(f),f=_u,(v=Sa())!==o&&(Ou=f,v=Eu(0,v)),f=v;Ou=t,t=function(t,n){return Xa([{colorArrows:t}].concat(n[0]))}(a,l)}else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;if(t===o){if(t=_u,r=aa(),(e=Ra())!==o)if(37===n.charCodeAt(_u)?(i="%",_u++):(i=o,0===Uu&&Fu(hi)),i!==o)if((u=function(){var t,r;return t=_u,n.substr(_u,3)===Vn?(r=Vn,_u+=3):(r=o,0===Uu&&Fu(xi)),r!==o&&(Ou=t,r="clk"),(t=r)===o&&(t=_u,n.substr(_u,3)===Hn?(r=Hn,_u+=3):(r=o,0===Uu&&Fu(Ni)),r!==o&&(Ou=t,r="egt"),(t=r)===o&&(t=_u,n.substr(_u,3)===zn?(r=zn,_u+=3):(r=o,0===Uu&&Fu(_i)),r!==o&&(Ou=t,r="emt"),t=r)),t}())!==o)if((a=sa())!==o)if((s=Ba())!==o)if(c=aa(),Pa()!==o){for(l=aa(),f=[],v=_u,(p=Sa())!==o&&(Ou=v,p=yu(0,0,p)),v=p;v!==o;)f.push(v),v=_u,(p=Sa())!==o&&(Ou=v,p=yu(0,0,p)),v=p;Ou=t,t=ku(u,s,f)}else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;if(t===o){if(t=_u,r=aa(),(e=Ra())!==o)if(37===n.charCodeAt(_u)?(i="%",_u++):(i=o,0===Uu&&Fu(hi)),i!==o)if((u=function(){var t,r;return t=_u,n.substr(_u,3)===Zn?(r=Zn,_u+=3):(r=o,0===Uu&&Fu(Oi)),r!==o&&(Ou=t,r="mct"),r}())!==o)if((a=sa())!==o)if((s=function(){var t,n,r,e;return t=_u,(n=Ua())===o&&(n=null),(r=Da())!==o?((e=Da())===o&&(e=null),Ou=t,t=function(t,n,r){let e=n;return t?e=t+e:za({message:"Hours and minutes missing"}),t&&2==(t.match(/:/g)||[]).length&&1==t.search(":")&&za({message:"Only 2 digits for hours normally used"}),r?e+=r:za({message:"Only 2 digit for seconds normally used"}),e}(n,r,e)):(_u=t,t=o),t}())!==o)if(c=aa(),Pa()!==o){for(l=aa(),f=[],v=_u,(p=Sa())!==o&&(Ou=v,p=yu(0,0,p)),v=p;v!==o;)f.push(v),v=_u,(p=Sa())!==o&&(Ou=v,p=yu(0,0,p)),v=p;Ou=t,t=ku(u,s,f)}else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;if(t===o){if(t=_u,r=aa(),(e=Ra())!==o)if(n.substr(_u,5)===Gn?(i=Gn,_u+=5):(i=o,0===Uu&&Fu(gi)),i!==o)if((u=sa())!==o)if(a=la(),s=aa(),(c=Pa())!==o){for(aa(),l=[],f=_u,(v=Sa())!==o&&(Ou=f,v=Su(0,v)),f=v;f!==o;)l.push(f),f=_u,(v=Sa())!==o&&(Ou=f,v=Su(0,v)),f=v;Ou=t,t=function(t,n){var r={};return r.eval=parseFloat(t),Xa([r].concat(n[0]))}(a,l)}else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;if(t===o){if(t=_u,r=aa(),(e=Ra())!==o)if(37===n.charCodeAt(_u)?(i="%",_u++):(i=o,0===Uu&&Fu(hi)),i!==o)if(u=la(),(a=sa())!==o){if(s=[],(c=wa())!==o)for(;c!==o;)s.push(c),c=wa();else s=o;if(s!==o)if((c=Pa())!==o){for(aa(),l=[],f=_u,(v=Sa())!==o&&(Ou=f,v=Tu(0,0,v)),f=v;f!==o;)l.push(f),f=_u,(v=Sa())!==o&&(Ou=f,v=Tu(0,0,v)),f=v;Ou=t,t=function(t,n,r){var e={};return e[t]=n.join(""),Xa([e].concat(r[0]))}(u,s,l)}else _u=t,t=o;else _u=t,t=o}else _u=t,t=o;else _u=t,t=o;else _u=t,t=o;if(t===o){if(t=_u,r=[],(e=Ta())!==o)for(;e!==o;)r.push(e),e=Ta();else r=o;if(r!==o){for(e=[],i=_u,u=aa(),(a=Sa())!==o?(Ou=i,i=wu(0,a)):(_u=i,i=o);i!==o;)e.push(i),i=_u,u=aa(),(a=Sa())!==o?(Ou=i,i=wu(0,a)):(_u=i,i=o);Ou=t,t=function(t,n){return n.length>0?Xa([{comment:ts(t.join(""))}].concat(Ja(n[0]))):{comment:t.join("")}}(r,e)}else _u=t,t=o}}}}}}return t}function Ta(){var t,r,e,i;return t=_u,r=_u,Uu++,"[%"===n.substr(_u,2)?(e="[%",_u+=2):(e=o,0===Uu&&Fu(mi)),Uu--,e===o?r=void 0:(_u=r,r=o),r!==o?(e=_u,Uu++,125===n.charCodeAt(_u)?(i="}",_u++):(i=o,0===Uu&&Fu(di)),Uu--,i===o?e=void 0:(_u=e,e=o),e!==o?(n.length>_u?(i=n.charAt(_u),_u++):(i=o,0===Uu&&Fu(Zo)),i!==o?(Ou=t,t=i):(_u=t,t=o)):(_u=t,t=o)):(_u=t,t=o),t}function wa(){var t,r,e;return t=_u,r=_u,Uu++,e=Pa(),Uu--,e===o?r=void 0:(_u=r,r=o),r!==o?(n.length>_u?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Zo)),e!==o?(Ou=t,t=e):(_u=t,t=o)):(_u=t,t=o),t}function xa(){var t,n,r;return t=_u,(n=_a())!==o&&(r=Oa())!==o?(Ou=t,t=n+r):(_u=t,t=o),t}function Na(){var t,n,r,e;return t=_u,(n=_a())!==o&&(r=Oa())!==o&&(e=Oa())!==o?(Ou=t,t=n+r+e):(_u=t,t=o),t}function _a(){var t,r;return t=_u,89===n.charCodeAt(_u)?(r="Y",_u++):(r=o,0===Uu&&Fu(Ci)),r!==o&&(Ou=t,r="Y"),(t=r)===o&&(t=_u,71===n.charCodeAt(_u)?(r="G",_u++):(r=o,0===Uu&&Fu(Ei)),r!==o&&(Ou=t,r="G"),(t=r)===o&&(t=_u,82===n.charCodeAt(_u)?(r="R",_u++):(r=o,0===Uu&&Fu(yi)),r!==o&&(Ou=t,r="R"),(t=r)===o&&(t=_u,66===n.charCodeAt(_u)?(r="B",_u++):(r=o,0===Uu&&Fu(ri)),r!==o&&(Ou=t,r="B"),t=r))),t}function Oa(){var t,n,r;return t=_u,(n=Ga())!==o&&(r=Ka())!==o?(Ou=t,t=n+r):(_u=t,t=o),t}function Ra(){var t;return 91===n.charCodeAt(_u)?(t="[",_u++):(t=o,0===Uu&&Fu(Si)),t}function Pa(){var t;return 93===n.charCodeAt(_u)?(t="]",_u++):(t=o,0===Uu&&Fu(Ti)),t}function Ba(){var t,n,r,e,i;return t=_u,(n=Ua())===o&&(n=null),(r=Da())!==o?((e=Da())===o&&(e=null),(i=ga())===o&&(i=null),Ou=t,t=function(t,n,r,e){let o=n;return t?o=t+o:za({message:"Hours and minutes missing"}),t&&2==(t.match(/:/g)||[]).length&&2==t.search(":")&&za({message:"Only 1 digit for hours normally used"}),r?o+=r:za({message:"Only 2 digit for seconds normally used"}),e&&(za({message:"Unusual use of millis in clock value"}),o+="."+e),o}(n,r,e,i)):(_u=t,t=o),t}function Ua(){var t,r,e,i,u;return t=_u,(r=function(){var t,r,e,i;return t=_u,(r=Da())!==o?((e=Da())===o&&(e=null),58===n.charCodeAt(_u)?(i=Wn,_u++):(i=o,0===Uu&&Fu(ti)),i!==o?(Ou=t,t=function(t,n){let r=t;return r+=n?n+":":":",r}(r,e)):(_u=t,t=o)):(_u=t,t=o),t}())!==o?((e=function(){var t,r,e,i;return t=_u,(r=Da())!==o?((e=Da())===o&&(e=null),58===n.charCodeAt(_u)?(i=Wn,_u++):(i=o,0===Uu&&Fu(ti)),i!==o?(Ou=t,t=function(t,n){let r=t;return n?r+=n+":":(r+=":",za({message:"Only 2 digits for minutes normally used"})),r}(r,e)):(_u=t,t=o)):(_u=t,t=o),t}())===o&&(e=null),Ou=t,i=r,t=(u=e)?i+u:(za({message:"No hours found"}),i)):(_u=t,t=o),t}function Da(){var t,r;return t=_u,cr.test(n.charAt(_u))?(r=n.charAt(_u),_u++):(r=o,0===Uu&&Fu(Jo)),r!==o&&(Ou=t,r=r),r}function La(){var t,r,e,i,u;return t=_u,function(){var t;return 40===n.charCodeAt(_u)?(t="(",_u++):(t=o,0===Uu&&Fu(Ri)),t}()!==o&&(r=Ea())!==o&&function(){var t;return 41===n.charCodeAt(_u)?(t=")",_u++):(t=o,0===Uu&&Fu(Pi)),t}()!==o?(aa(),(e=La())===o&&(e=null),Ou=t,i=r,(u=e||[]).unshift(i),t=u):(_u=t,t=o),t}function Ia(){var t;return 46===n.charCodeAt(_u)?(t=In,_u++):(t=o,0===Uu&&Fu(Xo)),t}function Wa(){var t,r,e;if(Uu++,t=_u,r=[],cr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Jo)),e!==o)for(;e!==o;)r.push(e),cr.test(n.charAt(_u))?(e=n.charAt(_u),_u++):(e=o,0===Uu&&Fu(Jo));else r=o;return r!==o&&(Ou=t,r=bu(r)),Uu--,(t=r)===o&&(r=o,0===Uu&&Fu(Bi)),t}function $a(){var t,r,e;if(t=_u,r=[],32===n.charCodeAt(_u)?(e=" ",_u++):(e=o,0===Uu&&Fu(Ui)),e!==o)for(;e!==o;)r.push(e),32===n.charCodeAt(_u)?(e=" ",_u++):(e=o,0===Uu&&Fu(Ui));else r=o;return r!==o&&(Ou=t,r=""),r}function Fa(){var t,r,e,i;return t=_u,r=_u,e=_u,Uu++,n.substr(_u,2)===Jn?(i=Jn,_u+=2):(i=o,0===Uu&&Fu(Wi)),Uu--,i===o?e=void 0:(_u=e,e=o),e!==o?(43===n.charCodeAt(_u)?(i="+",_u++):(i=o,0===Uu&&Fu(ai)),i!==o?r=e=[e,i]:(_u=r,r=o)):(_u=r,r=o),r!==o&&(Ou=t,r=Nu(r)),(t=r)===o&&(t=_u,r=_u,e=_u,Uu++,"$$$"===n.substr(_u,3)?(i="$$$",_u+=3):(i=o,0===Uu&&Fu($i)),Uu--,i===o?e=void 0:(_u=e,e=o),e!==o?(35===n.charCodeAt(_u)?(i="#",_u++):(i=o,0===Uu&&Fu(Fi)),i!==o?r=e=[e,i]:(_u=r,r=o)):(_u=r,r=o),r!==o&&(Ou=t,r=Nu(r)),t=r),t}function ja(){var t,r,e;return t=_u,61===n.charCodeAt(_u)?(r="=",_u++):(r=o,0===Uu&&Fu(ji)),r!==o&&(e=function(){var t;return vr.test(n.charAt(_u))?(t=n.charAt(_u),_u++):(t=o,0===Uu&&Fu(vu)),t}())!==o?(Ou=t,t="="+e):(_u=t,t=o),t}function Ma(){var t,r,e,i,u;return t=_u,(r=function(){var t,r,e;return t=_u,36===n.charCodeAt(_u)?(r="$",_u++):(r=o,0===Uu&&Fu(Mi)),r!==o&&(e=Wa())!==o?(Ou=t,i=e,t="$"+i):(_u=t,t=o),t===o&&(t=_u,n.substr(_u,2)===tr?(r=tr,_u+=2):(r=o,0===Uu&&Fu(qi)),r!==o&&(Ou=t,r="$3"),(t=r)===o&&(t=_u,n.substr(_u,2)===nr?(r=nr,_u+=2):(r=o,0===Uu&&Fu(Qi)),r!==o&&(Ou=t,r="$4"),(t=r)===o&&(t=_u,n.substr(_u,2)===rr?(r=rr,_u+=2):(r=o,0===Uu&&Fu(Gi)),r!==o&&(Ou=t,r="$5"),(t=r)===o&&(t=_u,n.substr(_u,2)===er?(r=er,_u+=2):(r=o,0===Uu&&Fu(Ki)),r!==o&&(Ou=t,r="$6"),(t=r)===o&&(t=_u,33===n.charCodeAt(_u)?(r="!",_u++):(r=o,0===Uu&&Fu(Vi)),r!==o&&(Ou=t,r="$1"),(t=r)===o&&(t=_u,63===n.charCodeAt(_u)?(r=Fn,_u++):(r=o,0===Uu&&Fu(ii)),r!==o&&(Ou=t,r="$2"),(t=r)===o&&(t=_u,8252===n.charCodeAt(_u)?(r="‼",_u++):(r=o,0===Uu&&Fu(Hi)),r!==o&&(Ou=t,r="$3"),(t=r)===o&&(t=_u,8263===n.charCodeAt(_u)?(r="⁇",_u++):(r=o,0===Uu&&Fu(zi)),r!==o&&(Ou=t,r="$4"),(t=r)===o&&(t=_u,8265===n.charCodeAt(_u)?(r="⁉",_u++):(r=o,0===Uu&&Fu(Zi)),r!==o&&(Ou=t,r="$5"),(t=r)===o&&(t=_u,8264===n.charCodeAt(_u)?(r="⁈",_u++):(r=o,0===Uu&&Fu(Yi)),r!==o&&(Ou=t,r="$6"),(t=r)===o&&(t=_u,9633===n.charCodeAt(_u)?(r="□",_u++):(r=o,0===Uu&&Fu(Xi)),r!==o&&(Ou=t,r="$7"),(t=r)===o&&(t=_u,61===n.charCodeAt(_u)?(r="=",_u++):(r=o,0===Uu&&Fu(ji)),r!==o&&(Ou=t,r="$10"),(t=r)===o&&(t=_u,8734===n.charCodeAt(_u)?(r="∞",_u++):(r=o,0===Uu&&Fu(Ji)),r!==o&&(Ou=t,r="$13"),(t=r)===o&&(t=_u,10866===n.charCodeAt(_u)?(r="⩲",_u++):(r=o,0===Uu&&Fu(tu)),r!==o&&(Ou=t,r="$14"),(t=r)===o&&(t=_u,10865===n.charCodeAt(_u)?(r="⩱",_u++):(r=o,0===Uu&&Fu(nu)),r!==o&&(Ou=t,r="$15"),(t=r)===o&&(t=_u,177===n.charCodeAt(_u)?(r="±",_u++):(r=o,0===Uu&&Fu(ru)),r!==o&&(Ou=t,r="$16"),(t=r)===o&&(t=_u,8723===n.charCodeAt(_u)?(r="∓",_u++):(r=o,0===Uu&&Fu(eu)),r!==o&&(Ou=t,r="$17"),(t=r)===o&&(t=_u,n.substr(_u,2)===Jn?(r=Jn,_u+=2):(r=o,0===Uu&&Fu(Wi)),r!==o&&(Ou=t,r="$18"),(t=r)===o&&(t=_u,n.substr(_u,2)===or?(r=or,_u+=2):(r=o,0===Uu&&Fu(ou)),r!==o&&(Ou=t,r="$19"),(t=r)===o&&(t=_u,10752===n.charCodeAt(_u)?(r="⨀",_u++):(r=o,0===Uu&&Fu(iu)),r!==o&&(Ou=t,r="$22"),(t=r)===o&&(t=_u,10227===n.charCodeAt(_u)?(r="⟳",_u++):(r=o,0===Uu&&Fu(uu)),r!==o&&(Ou=t,r="$32"),(t=r)===o&&(t=_u,8594===n.charCodeAt(_u)?(r="→",_u++):(r=o,0===Uu&&Fu(au)),r!==o&&(Ou=t,r="$36"),(t=r)===o&&(t=_u,8593===n.charCodeAt(_u)?(r="↑",_u++):(r=o,0===Uu&&Fu(su)),r!==o&&(Ou=t,r="$40"),(t=r)===o&&(t=_u,8646===n.charCodeAt(_u)?(r="⇆",_u++):(r=o,0===Uu&&Fu(cu)),r!==o&&(Ou=t,r="$132"),(t=r)===o&&(t=_u,68===n.charCodeAt(_u)?(r="D",_u++):(r=o,0===Uu&&Fu(lu)),r!==o&&(Ou=t,r="$220"),t=r))))))))))))))))))))))))),t;var i}())!==o?(aa(),(e=Ma())===o&&(e=null),Ou=t,i=r,(u=e||[]).unshift(i),t=u):(_u=t,t=o),t}function qa(){var t;return(t=Ga())===o&&(t=Ka()),t}function Qa(){var t;return fr.test(n.charAt(_u))?(t=n.charAt(_u),_u++):(t=o,0===Uu&&Fu(fu)),t}function Ga(){var t;return pr.test(n.charAt(_u))?(t=n.charAt(_u),_u++):(t=o,0===Uu&&Fu(pu)),t}function Ka(){var t;return hr.test(n.charAt(_u))?(t=n.charAt(_u),_u++):(t=o,0===Uu&&Fu(hu)),t}function Va(){var t;return 120===n.charCodeAt(_u)?(t="x",_u++):(t=o,0===Uu&&Fu(gu)),t}var Ha=[];function za(t){var n=Object.assign(t,$u(Ou,_u));return Ha.push(n),n}function Za(t){return parseInt(t.join(""),10)}function Ya(t){return t.join("").match(/\?/)?t.join(""):Za(t)}function Xa(t){var n={};return t.forEach((function(t){for(var r in t)Array.isArray(t[r])?n[r]=n[r]?n[r].concat(t[r]):t[r]:n[r]=n[r]?ts(n[r])+" "+Ja(t[r]):t[r]})),n}function Ja(t){if("string"!=typeof t)return t;return t.replace(/^\s+/,"")}function ts(t){if("string"!=typeof t)return t;return t.replace(/\s+$/,"")}if((e=a())!==o&&_u===n.length)return e;throw e!==o&&_u<n.length&&Fu({type:"end"}),function(n,r,e){return new t(t.buildMessage(n,r),n,r,e)}(Bu,Pu<n.length?n.charAt(Pu):null,Pu<n.length?$u(Pu,Pu+1):$u(Pu,Pu))}}})?r.apply(n,[]):r)||(t.exports=e)},597:(t,n,r)=>{const e=r(5),o=r(9);t.exports={parser:o,splitter:e}},9:(t,n,r)=>{const e=r(586);t.exports={SyntaxError:e.SyntaxError,parse:function(t,n){n&&"pgn"!==n.startRule&&"game"!==n.startRule||(t=t.trim());let r=e.parse(t,n);return o=n,function(t){function r(t){function n(t,r){return t.turn=r,t.variations&&t.variations.forEach((function(t){let e=r;t.forEach((t=>e=n(t,e)))})),function(t){return"w"===t?"b":"w"}(r)}let r=(o.fen||t.tags&&t.tags.FEN||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1").split(/\s+/)[1];return t.moves.forEach((t=>r=n(t,r))),t}return"game"===n.startRule?r(t):"pgn"===n.startRule?r({moves:t}).moves:("games"===n.startRule&&t.forEach((t=>r(t))),t)}(function(t){if(n&&"games"===n.startRule){if(!Array.isArray(t))return[];if(0===t.length)return t;let n=t.pop();(Object.keys(n.tags).length>0||n.moves.length>0)&&t.push(n)}return t}(r));var o}}},5:t=>{t.exports={split:function(t,n){let r=((t,n="\n")=>t.replace(/\r?\n/g,n))(t).split("\n\n"),e=[],o={};return r.forEach((function(t){if(t.startsWith("["))o.tags=t;else if(t){o.pgn=t;let n=o.tags?o.tags+"\n\n"+o.pgn:o.pgn;o.all=n,e.push(o),o={}}})),e}}},437:(t,n,r)=>{var e,o=function(t){var n="b",r="w",e=-1,o="p",i="k",u="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",a=["1-0","0-1","1/2-1/2","*"],s={b:[16,32,17,15],w:[-16,-32,-17,-15]},c={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},l=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],f=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],v={p:0,n:1,b:2,r:3,q:4,k:5},p={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},h={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},g={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},m={w:[{square:g.a1,flag:h.QSIDE_CASTLE},{square:g.h1,flag:h.KSIDE_CASTLE}],b:[{square:g.a8,flag:h.QSIDE_CASTLE},{square:g.h8,flag:h.KSIDE_CASTLE}]},d=new Array(128),b={w:e,b:e},A=r,C={w:0,b:0},E=e,y=0,k=1,S=[],T={};function w(t){void 0===t&&(t=!1),d=new Array(128),b={w:e,b:e},A=r,C={w:0,b:0},E=e,y=0,k=1,S=[],t||(T={}),P(O())}function x(){N(u)}function N(t,o){void 0===o&&(o=!1);var i=t.split(/\s+/),u=i[0],a=0;if(!_(t).valid)return!1;w(o);for(var s=0;s<u.length;s++){var c=u.charAt(s);if("/"===c)a+=8;else if(-1!=="0123456789".indexOf(c))a+=parseInt(c,10);else{var l=c<"a"?r:n;U({type:c.toLowerCase(),color:l},Y(a)),a++}}return A=i[1],i[2].indexOf("K")>-1&&(C.w|=h.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(C.w|=h.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(C.b|=h.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(C.b|=h.QSIDE_CASTLE),E="-"===i[3]?e:g[i[3]],y=parseInt(i[4],10),k=parseInt(i[5],10),P(O()),!0}function _(t){var n=t.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:"FEN string must contain six space-delimited fields."};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:"6th field (move number) must be a positive integer."};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:"5th field (half move counter) must be a non-negative integer."};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:"4th field (en-passant square) is invalid."};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:"3rd field (castling availability) is invalid."};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:"2nd field (side to move) is invalid."};var r=n[0].split("/");if(8!==r.length)return{valid:!1,error_number:7,error:"1st field (piece positions) does not contain 8 '/'-delimited rows."};for(var e=0;e<r.length;e++){for(var o=0,i=!1,u=0;u<r[e].length;u++)if(isNaN(r[e][u])){if(!/^[prnbqkPRNBQK]$/.test(r[e][u]))return{valid:!1,error_number:9,error:"1st field (piece positions) is invalid [invalid piece]."};o+=1,i=!1}else{if(i)return{valid:!1,error_number:8,error:"1st field (piece positions) is invalid [consecutive numbers]."};o+=parseInt(r[e][u],10),i=!0}if(8!==o)return{valid:!1,error_number:10,error:"1st field (piece positions) is invalid [row too large]."}}return"3"==n[3][1]&&"w"==n[1]||"6"==n[3][1]&&"b"==n[1]?{valid:!1,error_number:11,error:"Illegal en-passant square"}:{valid:!0,error_number:0,error:"No errors."}}function O(){for(var t=0,n="",o=g.a8;o<=g.h1;o++){if(null==d[o])t++;else{t>0&&(n+=t,t=0);var i=d[o].color,u=d[o].type;n+=i===r?u.toUpperCase():u.toLowerCase()}o+1&136&&(t>0&&(n+=t),o!==g.h1&&(n+="/"),t=0,o+=8)}var a="";C.w&h.KSIDE_CASTLE&&(a+="K"),C.w&h.QSIDE_CASTLE&&(a+="Q"),C.b&h.KSIDE_CASTLE&&(a+="k"),C.b&h.QSIDE_CASTLE&&(a+="q"),a=a||"-";var s=E===e?"-":Y(E);return[n,A,a,s,y,k].join(" ")}function R(t){for(var n=0;n<t.length;n+=2)"string"==typeof t[n]&&"string"==typeof t[n+1]&&(T[t[n]]=t[n+1]);return T}function P(t){S.length>0||(t!==u?(T.SetUp="1",T.FEN=t):(delete T.SetUp,delete T.FEN))}function B(t){var n=d[g[t]];return n?{type:n.type,color:n.color}:null}function U(t,n){if(!("type"in t)||!("color"in t))return!1;if(-1==="pnbrqkPNBRQK".indexOf(t.type.toLowerCase()))return!1;if(!(n in g))return!1;var r=g[n];return(t.type!=i||b[t.color]==e||b[t.color]==r)&&(d[r]={type:t.type,color:t.color},t.type===i&&(b[t.color]=r),P(O()),!0)}function D(t,n,r,e,i){var u={color:A,from:n,to:r,flags:e,piece:t[n].type};return i&&(u.flags|=h.PROMOTION,u.promotion=i),t[r]?u.captured=t[r].type:e&h.EP_CAPTURE&&(u.captured=o),u}function L(t){function n(t,n,r,e,i){if(t[r].type!==o||0!==z(e)&&7!==z(e))n.push(D(t,r,e,i));else for(var u=["q","r","b","n"],a=0,s=u.length;a<s;a++)n.push(D(t,r,e,i,u[a]))}var r=[],e=A,i=X(e),u={b:1,w:6},a=g.a8,l=g.h1,f=!1,v=void 0===t||!("legal"in t)||t.legal;if(void 0!==t&&"square"in t){if(!(t.square in g))return[];a=l=g[t.square],f=!0}for(var p=a;p<=l;p++)if(136&p)p+=7;else{var m=d[p];if(null!=m&&m.color===e)if(m.type===o){var y=p+s[e][0];for(null==d[y]&&(n(d,r,p,y,h.NORMAL),y=p+s[e][1],u[e]===z(p)&&null==d[y]&&n(d,r,p,y,h.BIG_PAWN)),k=2;k<4;k++)136&(y=p+s[e][k])||(null!=d[y]&&d[y].color===i?n(d,r,p,y,h.CAPTURE):y===E&&n(d,r,p,E,h.EP_CAPTURE))}else for(var k=0,S=c[m.type].length;k<S;k++){var T=c[m.type][k];for(y=p;!(136&(y+=T));){if(null!=d[y]){if(d[y].color===e)break;n(d,r,p,y,h.CAPTURE);break}if(n(d,r,p,y,h.NORMAL),"n"===m.type||"k"===m.type)break}}}if(!f||l===b[e]){if(C[e]&h.KSIDE_CASTLE){var w=(x=b[e])+2;null!=d[x+1]||null!=d[w]||$(i,b[e])||$(i,x+1)||$(i,w)||n(d,r,b[e],w,h.KSIDE_CASTLE)}var x;if(C[e]&h.QSIDE_CASTLE)w=(x=b[e])-2,null!=d[x-1]||null!=d[x-2]||null!=d[x-3]||$(i,b[e])||$(i,x-1)||$(i,w)||n(d,r,b[e],w,h.QSIDE_CASTLE)}if(!v)return r;var N=[];for(p=0,S=r.length;p<S;p++)K(r[p]),F(e)||N.push(r[p]),V();return N}function I(t,n){var r="";if(t.flags&h.KSIDE_CASTLE)r="O-O";else if(t.flags&h.QSIDE_CASTLE)r="O-O-O";else{var e=function(t,n){for(var r=L({legal:!n}),e=t.from,o=t.to,i=t.piece,u=0,a=0,s=0,c=0,l=r.length;c<l;c++){var f=r[c].from,v=r[c].to;i===r[c].piece&&e!==f&&o===v&&(u++,z(e)===z(f)&&a++,Z(e)===Z(f)&&s++)}return u>0?a>0&&s>0?Y(e):s>0?Y(e).charAt(1):Y(e).charAt(0):""}(t,n);t.piece!==o&&(r+=t.piece.toUpperCase()+e),t.flags&(h.CAPTURE|h.EP_CAPTURE)&&(t.piece===o&&(r+=Y(t.from)[0]),r+="x"),r+=Y(t.to),t.flags&h.PROMOTION&&(r+="="+t.promotion.toUpperCase())}return K(t),j()&&(M()?r+="#":r+="+"),V(),r}function W(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function $(t,e){for(var i=g.a8;i<=g.h1;i++)if(136&i)i+=7;else if(null!=d[i]&&d[i].color===t){var u=d[i],a=i-e,s=a+119;if(l[s]&1<<v[u.type]){if(u.type===o){if(a>0){if(u.color===r)return!0}else if(u.color===n)return!0;continue}if("n"===u.type||"k"===u.type)return!0;for(var c=f[s],p=i+c,h=!1;p!==e;){if(null!=d[p]){h=!0;break}p+=c}if(!h)return!0}}return!1}function F(t){return $(X(t),b[t])}function j(){return F(A)}function M(){return j()&&0===L().length}function q(){return!j()&&0===L().length}function Q(){for(var t={},n=[],r=0,e=0,o=g.a8;o<=g.h1;o++)if(e=(e+1)%2,136&o)o+=7;else{var i=d[o];i&&(t[i.type]=i.type in t?t[i.type]+1:1,"b"===i.type&&n.push(e),r++)}if(2===r)return!0;if(3===r&&(1===t.b||1===t.n))return!0;if(r===t.b+2){var u=0,a=n.length;for(o=0;o<a;o++)u+=n[o];if(0===u||u===a)return!0}return!1}function G(){for(var t=[],n={},r=!1;;){var e=V();if(!e)break;t.push(e)}for(;;){var o=O().split(" ").slice(0,4).join(" ");if(n[o]=o in n?n[o]+1:1,n[o]>=3&&(r=!0),!t.length)break;K(t.pop())}return r}function K(t){var r=A,u=X(r);if(function(t){S.push({move:t,kings:{b:b.b,w:b.w},turn:A,castling:{b:C.b,w:C.w},ep_square:E,half_moves:y,move_number:k})}(t),d[t.to]=d[t.from],d[t.from]=null,t.flags&h.EP_CAPTURE&&(A===n?d[t.to-16]=null:d[t.to+16]=null),t.flags&h.PROMOTION&&(d[t.to]={type:t.promotion,color:r}),d[t.to].type===i){if(b[d[t.to].color]=t.to,t.flags&h.KSIDE_CASTLE){var a=t.to-1,s=t.to+1;d[a]=d[s],d[s]=null}else t.flags&h.QSIDE_CASTLE&&(a=t.to+1,s=t.to-2,d[a]=d[s],d[s]=null);C[r]=""}if(C[r])for(var c=0,l=m[r].length;c<l;c++)if(t.from===m[r][c].square&&C[r]&m[r][c].flag){C[r]^=m[r][c].flag;break}if(C[u])for(c=0,l=m[u].length;c<l;c++)if(t.to===m[u][c].square&&C[u]&m[u][c].flag){C[u]^=m[u][c].flag;break}E=t.flags&h.BIG_PAWN?"b"===A?t.to-16:t.to+16:e,t.piece===o||t.flags&(h.CAPTURE|h.EP_CAPTURE)?y=0:y++,A===n&&k++,A=X(A)}function V(){var t=S.pop();if(null==t)return null;var r=t.move;b=t.kings,A=t.turn,C=t.castling,E=t.ep_square,y=t.half_moves,k=t.move_number;var e,i,u=A,a=X(A);if(d[r.from]=d[r.to],d[r.from].type=r.piece,d[r.to]=null,r.flags&h.CAPTURE)d[r.to]={type:r.captured,color:a};else if(r.flags&h.EP_CAPTURE){var s;s=u===n?r.to-16:r.to+16,d[s]={type:o,color:a}}return r.flags&(h.KSIDE_CASTLE|h.QSIDE_CASTLE)&&(r.flags&h.KSIDE_CASTLE?(e=r.to+1,i=r.to-1):r.flags&h.QSIDE_CASTLE&&(e=r.to-2,i=r.to+1),d[e]=d[i],d[i]=null),r}function H(t,n){var r=W(t);if(n){var e=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(e)var o=e[1],i=e[2],u=e[3],a=e[4]}for(var s=L(),c=0,l=s.length;c<l;c++){if(r===W(I(s[c]))||n&&r===W(I(s[c],!0)))return s[c];if(e&&(!o||o.toLowerCase()==s[c].piece)&&g[i]==s[c].from&&g[u]==s[c].to&&(!a||a.toLowerCase()==s[c].promotion))return s[c]}return null}function z(t){return t>>4}function Z(t){return 15&t}function Y(t){var n=Z(t),r=z(t);return"abcdefgh".substring(n,n+1)+"87654321".substring(r,r+1)}function X(t){return t===r?n:r}function J(t){var n=tt(t);n.san=I(n,!1),n.to=Y(n.to),n.from=Y(n.from);var r="";for(var e in h)h[e]&n.flags&&(r+=p[e]);return n.flags=r,n}function tt(t){var n=t instanceof Array?[]:{};for(var r in t)n[r]="object"==typeof r?tt(t[r]):t[r];return n}function nt(t){return t.replace(/^\s+|\s+$/g,"")}function rt(t){for(var n=L({legal:!1}),r=0,e=A,o=0,i=n.length;o<i;o++)K(n[o]),F(e)||(t-1>0?r+=rt(t-1):r++),V();return r}return N(void 0===t?u:t),{WHITE:r,BLACK:n,PAWN:o,KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:i,SQUARES:function(){for(var t=[],n=g.a8;n<=g.h1;n++)136&n?n+=7:t.push(Y(n));return t}(),FLAGS:p,load:function(t){return N(t)},reset:function(){return x()},moves:function(t){for(var n=L(t),r=[],e=0,o=n.length;e<o;e++)void 0!==t&&"verbose"in t&&t.verbose?r.push(J(n[e])):r.push(I(n[e],!1));return r},in_check:function(){return j()},in_checkmate:function(){return M()},in_stalemate:function(){return q()},in_draw:function(){return y>=100||q()||Q()||G()},insufficient_material:function(){return Q()},in_threefold_repetition:function(){return G()},game_over:function(){return y>=100||M()||q()||Q()||G()},validate_fen:function(t){return _(t)},fen:function(){return O()},board:function(){for(var t=[],n=[],r=g.a8;r<=g.h1;r++)null==d[r]?n.push(null):n.push({type:d[r].type,color:d[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t},pgn:function(t){var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\n",r="object"==typeof t&&"number"==typeof t.max_width?t.max_width:0,e=[],o=!1;for(var i in T)e.push("["+i+' "'+T[i]+'"]'+n),o=!0;o&&S.length&&e.push(n);for(var u=[];S.length>0;)u.push(V());for(var a=[],s="";u.length>0;){var c=u.pop();S.length||"b"!==c.color?"w"===c.color&&(s.length&&a.push(s),s=k+"."):s=k+". ...",s=s+" "+I(c,!1),K(c)}if(s.length&&a.push(s),void 0!==T.Result&&a.push(T.Result),0===r)return e.join("")+a.join(" ");var l=0;for(i=0;i<a.length;i++)l+a[i].length>r&&0!==i?(" "===e[e.length-1]&&e.pop(),e.push(n),l=0):0!==i&&(e.push(" "),l++),e.push(a[i]),l+=a[i].length;return e.join("")},load_pgn:function(t,n){var r=void 0!==n&&"sloppy"in n&&n.sloppy;function e(t){return t.replace(/\\/g,"\\")}var o="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+e(o)+")|.)*\\])(?:"+e(o)+"){2}"),u=i.test(t)?i.exec(t)[1]:"";x();var s=function(t,n){for(var r="object"==typeof n&&"string"==typeof n.newline_char?n.newline_char:"\r?\n",o={},i=t.split(new RegExp(e(r))),u="",a="",s=0;s<i.length;s++)u=i[s].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=i[s].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),nt(u).length>0&&(o[u]=a);return o}(u,n);for(var c in s)R([c,s[c]]);if(!("1"!==s.SetUp||"FEN"in s&&N(s.FEN,!0)))return!1;var l=t.replace(u,"").replace(new RegExp(e(o),"g")," ");l=l.replace(/(\{[^}]+\})+?/g,"");for(var f=/(\([^\(\)]+\))+?/g;f.test(l);)l=l.replace(f,"");var v=nt(l=(l=(l=l.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));v=v.join(",").replace(/,,+/g,",").split(",");for(var p="",h=0;h<v.length-1;h++){if(null==(p=H(v[h],r)))return!1;K(p)}if(p=v[v.length-1],a.indexOf(p)>-1)(function(t){for(var n in t)return!0;return!1})(T)&&void 0===T.Result&&R(["Result",p]);else{if(null==(p=H(p,r)))return!1;K(p)}return!0},header:function(){return R(arguments)},ascii:function(){return function(){for(var t="   +------------------------+\n",n=g.a8;n<=g.h1;n++){if(0===Z(n)&&(t+=" "+"87654321"[z(n)]+" |"),null==d[n])t+=" . ";else{var e=d[n].type;t+=" "+(d[n].color===r?e.toUpperCase():e.toLowerCase())+" "}n+1&136&&(t+="|\n",n+=8)}return(t+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return A},move:function(t,n){var r=void 0!==n&&"sloppy"in n&&n.sloppy,e=null;if("string"==typeof t)e=H(t,r);else if("object"==typeof t)for(var o=L(),i=0,u=o.length;i<u;i++)if(t.from===Y(o[i].from)&&t.to===Y(o[i].to)&&(!("promotion"in o[i])||t.promotion===o[i].promotion)){e=o[i];break}if(!e)return null;var a=J(e);return K(e),a},undo:function(){var t=V();return t?J(t):null},clear:function(){return w()},put:function(t,n){return U(t,n)},get:function(t){return B(t)},remove:function(t){return function(t){var n=B(t);return d[g[t]]=null,n&&n.type===i&&(b[n.color]=e),P(O()),n}(t)},perft:function(t){return rt(t)},square_color:function(t){if(t in g){var n=g[t];return(z(n)+Z(n))%2==0?"light":"dark"}return null},history:function(t){for(var n=[],r=[],e=(void 0!==t&&"verbose"in t&&t.verbose);S.length>0;)n.push(V());for(;n.length>0;){var o=n.pop();e?r.push(J(o)):r.push(I(o)),K(o)}return r}}};n.Chess=o,void 0===(e=function(){return o}.call(n,r,n,t))||(t.exports=e)}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,r),i.exports}r.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return r.d(n,{a:n}),n},r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var e={};return(()=>{"use strict";r.r(e),r.d(e,{StringBuilder:()=>i,pgnReader:()=>u});var t=r(597),n=r(437),o=r.n(n);function i(t){let n={};n.strings=new Array("");let r=function(t){t&&n.strings.push(t)};return r(t),{append:r,toString:function(){return n.strings.join("")},isEmpty:function(){for(let t=0;t<n.strings.length;t++)if(n.strings[t].length>0)return!1;return!0},lastChar:function(){return 0===n.strings.length?null:n.strings[n.strings.length-1].slice(-1)}}}const u=function(n){const r={};r.configuration=function(t){return t.pgn||(void 0===t.pgnFile?t.pgn="*":t.pgn=function(t){const n=new XMLHttpRequest;if(n.open("GET",t,!1),n.send(),200===n.status)return n.responseText}(t.pgnFile)),Object.assign({notation:"short",position:"start",locale:"en"},t)}(n);const e=new(o()),u=new Array(220);u[1]="!",u[2]="?",u[3]="‼",u[4]="⁇",u[5]="⁉",u[6]="⁈",u[7]="□",u[10]="=",u[13]="∞",u[14]="⩲",u[15]="⩱",u[16]="±",u[17]="∓",u[18]="+−",u[19]="-+",u[22]="⨀",u[23]="⨀",u[32]="⟳",u[33]="⟳",u[36]="→",u[37]="→",u[40]="↑",u[41]="↑",u[44]="=∞",u[132]="⇆",u[133]="⇆",u[136]="⊕",u[140]="∆",u[146]="N",u[220]="D",u[221]="D";const a={};for(let t=0;t<u.length;t++)a[u[t]]=t;function s(t){let n="";if(null==t)return n;for(let r=0;r<t.length;r++){const e=parseInt(t[r].substring(1));if(220!==e){const t=u[e];n+=void 0!==t?t:"$"+e}}return n}function c(t){return"P"===t?"":t}function l(t){let n=t.notation;if(void 0===n.row)return n.notation;const e=n.fig?c(n.fig):"";let o=n.disc?n.disc:"";const i=n.strike?n.strike:"";i&&!e&&(o=t.from.substring(0,1));const u=n.check?n.check:"",a=n.mate?n.mate:"",s=n.promotion?"="+c(n.promotion.substring(1,2)):"";return"short"===r.configuration.notation?e+o+i+n.col+n.row+s+u+a:"long"===r.configuration.notation?e+t.from+(n.strike?i:"-")+t.to+s+u+a:void 0}a["!!"]=3,a["??"]=4,a["!?"]=5,a["?!"]=6;let f=function(){if(r.configuration.manyGames)return r.games=t.parser.parse(r.configuration.pgn,{startRule:"games"}),v(r.games[0]),r;let n=t.parser.parse(r.configuration.pgn,{startRule:"game"});return r.games=[n],v(n),r};function v(t){r.currentGameIndex="number"==typeof t?t:0;let n="number"==typeof t?r.games[t]:t;if(function(t){if(t.tags.SetUp){const n=t.tags.SetUp;r.configuration.position="0"===n?"start":t.tags.FEN}t.tags.Result&&(r.endGame=t.tags.Result)}(n),p(n.moves),r.configuration.startPlay&&r.configuration.hideMovesBefore){let t=b(r.configuration.startPlay),n=C();r.configuration.startPlay=null,r.configuration.hideMovesBefore=!1,r.configuration.pgn=n,r.configuration.position=t,f()}}function p(t){let n=t;!function(t){"string"==typeof t[t.length-1]&&(r.endGame=t.pop())}(n),function(t){r.moves=[];let n=-1;!function t(o,i,u){let a=null!=u?r.moves[u]:null;o.forEach((function(o,s){n++,o.variationLevel=i,r.moves.push(o),s>0&&(r.moves[n-1].variationLevel>i?(a=function(t,n){for(;n>=0;){if(r.moves[n].variationLevel===t)return r.moves[n];n--}return null}(i,n-1),u=a.index):(u=n-1,a=r.moves[u])),function(t,n,r,e){null!=e&&(r.prev=n,e.next||(e.next=t)),r.index=t}(n,u,o,a),"number"==typeof o.prev?e.load(m(o.prev).fen):E();let c=e.move(o.notation.notation,{sloppy:!0});if(null===c)throw new Error("No legal move: "+o.notation.notation);let l=e.fen();o.fen=l,o.from=c.from,o.to=c.to,o.notation.notation=c.san,"c"===c.flags&&(o.notation.strike="x"),e.in_checkmate()?o.notation.check="#":e.in_check()&&(o.notation.check="+"),o.moveNumber=function(t){const n=t.split(/\s+/),r=parseInt(n[5],10);return"b"===n[1]?r:r-1}(l),o.variations.forEach((function(n){t(n,i+1,u)}))}))}(t,0,null)}(n),"b"===r.configuration.position.split(/\s+/)[1]&&h(0)&&"w"===r.moves[0].turn&&y().forEach((function(t){t.turn="w"===t.turn?"b":"w"})),y().forEach((function(t){for(let n=0;n<t.variations.length;n++)t.variations[n]=t.variations[n][0]}))}function h(t){return y().length>t}function g(t){if(!h(t))return!0;const n=y()[t];return null===n||(0!==t||!n)&&void 0}function m(t){return y()?y()[t]:void 0}function d(t,n){if(0===arguments.length)d(k(),0);else if(t.variationLevel=n,void 0!==t.next&&d(m(t.next),n),t.variations)for(let r=0;r<t.variations.length;r++)d(t.variations[r],n+1)}function b(t){let n=function(t){let e=r.moves[t].fen;return r.moves[t]=null,t<=0||n(t-1),e};if(void 0===t)return;if(null===t)return;if(t<=0)return;let e=n(t-1);return m(t).prev=null,e}function A(t){return t.variationLevel>0&&("number"!=typeof t.prev||y()[t.prev].next!==t.index)}function C(){function t(t){t.isEmpty()||" "===t.lastChar()||t.append(" ")}function n(n,r){null!=n&&(t(r),r.append("{"),r.append(n),r.append("}"))}function e(n,r){t(r),r.append("("),o(n,r),t(r),r.append(")")}function o(r,u){null!=r&&(!function(t,r){n(t.commentMove,r)}(r,u),function(n,r){t(r),"w"===n.turn?(r.append(""+n.moveNumber),r.append(".")):A(n)&&(r.append(""+n.moveNumber),r.append("..."))}(r,u),function(n,r){t(r),r.append(n.notation.notation)}(r,u),function(t,n){t.nag&&t.nag.forEach((function(t){n.append(t)}))}(r,u),function(t,r){n(t.commentAfter,r)}(r,u),function(t,r){if((t=>t.commentDiag&&(t.commentDiag.colorArrows&&t.commentDiag.colorArrows.length>0||t.commentDiag.colorFields&&t.commentDiag.colorFields.length>0))(t)){let e=i(""),o=!0;e.append("[%csl "),(t=>t.commentDiag.colorFields||[])(t).forEach((t=>{o?e.append(""):e.append(","),o=!1,e.append(t)})),e.append("]"),o=!0,e.append("[%cal "),(t=>t.commentDiag.colorArrows||[])(t).forEach((t=>{o?e.append(""):e.append(","),o=!1,e.append(t)})),e.append("]"),n(e.toString(),r)}}(r,u),function(t,n){for(let r=0;r<t.variations.length;r++)e(t.variations[r],n)}(r,u),o(function(t){return t.next?m(t.next):null}(r),u))}const u=i("");let a=0;for(;null===m(a);)a+=1;return s=m(a),c=u,function(t){n(S(),t)}(u),o(s,c),function(t){r.endGame&&(t.append(" "),t.append(r.endGame))}(c),c.toString();var s,c}function E(){"start"===r.configuration.position?e.reset():e.load(r.configuration.position)}function y(){return r.moves?r.moves:[]}function k(){let t=y();for(const n of t)if(null==n.variationLevel||0==n.variationLevel&&null==n.prev)return n}function S(){if(r.games)return r.games[r.currentGameIndex].gameComment?r.games[r.currentGameIndex].gameComment.comment:void 0}return r.configuration.lazyLoad||f(),{configuration:r.configuration,deleteMove:function t(n){function e(t,n){const r=t[n];return t.splice(n,1),r}if(g(n))return;if(0===n)return void(r.moves=[]);let o=m(n);if(A(o)){const n=m(m(o.prev).next).variations;for(let r=0;n.length;r++)if(n[r]===o)return e(n,r),void 0!==o.next&&t(o.next),void(y()[o.index]=null)}if(0===o.variations.length)return void 0!==o.next&&null!==o.next&&t(o.next),r.moves[o.prev].next=null,void(r.moves[n]=null);if(o.variations.length>0){void 0!==o.next&&t(o.next);let i=e(o.variations,0),u=i.variationLevel;r.moves[o.prev].next=i.index,r.moves[n]=null,d(i,u-1)}},deleteMovesBefore:b,isDeleted:g,promoteMove:function(t){const n=m(t);if(void 0===n.variationLevel||0===n.variationLevel)return;const r=function t(n){return A(n)?n:t(m(n.prev))}(n),e=null==r.prev?k():m(m(r.prev).next);let o;for(let t=0;t<e.variations.length;t++)e.variations[t]===r&&(o=t);if(o>0){let t=e.variations[o-1];e.variations[o-1]=e.variations[o],e.variations[o]=t}else if(null==e.prev){const t=e.variations;e.variations=r.variations,r.variations=t,r.variations[0]=e,d(r,0)}else{let t=e;const n=e.variations;m(e.prev).next=r.index,t.variations=r.variations,r.variations=n,r.variations[0]=t,d(r,r.variationLevel-1)}},readMoves:p,findMove:function(t){if(!isNaN(t)){t-=1;let n=m(0);for(;t>0;)t-=1,n=m(n.next);return n}let n=y();for(let r of n){if(r.fen.startsWith(t))return r;if(r.notation.notation===t)return r}},getMoves:y,getOrderedMoves:function t(n,r){if(0===arguments.length)return t(k(),[]);if(r.push(n),n.variations)for(let e=0;e<n.variations.length;e++)t(n.variations[e],r);return n.next?t(m(n.next),r):r},getMove:m,getFirstMove:k,getEndGame:function(){return r.endGame},getGameComment:S,getTags:function(){if(!r.games)return new Map;let t=r.games[r.currentGameIndex].tags;return new Map(Object.entries(t))},getGames:function(){return r.games},loadOne:v,getParser:()=>t.parser,writePgn:C,startVariation:A,startMainLine:function(t){return 0===t.variationLevel&&"number"!=typeof t.prev},endVariation:function(t){return t.variationLevel>0&&!t.next},afterMoveWithVariation:function(t){return y()[t.prev]&&y()[t.prev].variations.length>0},changeNag:function(t,n,r){let e=m(n);null==e.nag&&(e.nag=[]);let o="$"===t[0]?t:function(t){const n=a[t];return"undefined"===n?null:"$"+n}(t);if(r)-1===e.nag.indexOf(o)&&e.nag.push(o);else{let t=e.nag.indexOf(o);t>-1&&e.nag.splice(t,1)}},clearNags:function(t){m(t).nag=[]},addMove:function(t,n){let r=function(t,n){if(null==n)return function(t){E();let n=e.move(t);return n?(void 0===m(0)?null:m(0).notation.notation)===n.san?0:function(t){if(void 0===m(0))return null;let n,r=m(0).variations;for(n in r)if(r[n].notation.notation===t.san)return r[n].moveNumber;return null}(n):null}(t);let r=m(n);if(void 0===r)return null;e.load(r.fen);let o=e.move(t),i=m(r.next);if(void 0===i)return null;if(i.notation.notation===o.san)return r.next;{let t=m(r.next);for(let n=0;n<t.variations.length;n++){let r=t.variations[n];if(r.notation.notation===o.san)return r.index}}return null}(t,n);if("number"==typeof r)return r;let o={};o.from=t.from,o.to=t.to,o.notation={},o.variations=[],null==n?(E(),o.turn=e.turn(),o.moveNumber=1):(e.load(m(n).fen),o.turn=function(t){return"w"===m(t).turn?"b":"w"}(n),"w"===o.turn?o.moveNumber=m(n).moveNumber+1:o.moveNumber=m(n).moveNumber);let i=e.move(t);o.fen=e.fen(),"O"!==i.san.substring(0,1)?(o.notation.notation=i.san,o.notation.col=i.to.substring(0,1),o.notation.row=i.to.substring(1,2),"p"!==i.piece&&(o.notation.fig=i.piece.charAt(0).toUpperCase()),i.promotion&&(o.notation.promotion="="+i.promotion.toUpperCase()),(i.flags.includes(e.FLAGS.CAPTURE)||i.flags.includes(e.FLAGS.EP_CAPTURE))&&(o.notation.strike="x"),o.notation.ep=i.flags.includes(e.FLAGS.EP_CAPTURE),e.in_check()&&(e.in_checkmate()?o.notation.mate="#":o.notation.check="+")):o.notation.notation=i.san,y().push(o),o.prev=n;let u=y().length-1;return o.index=u,function(t,n,r){let e=m(n);if(void 0===e){if(r<=0)return;return m(0).variations.push(t),void(t.variationLevel=1)}e.next?(m(e.next).variations.push(t),t.variationLevel=(e.variationLevel?e.variationLevel:0)+1,"b"===t.turn&&(t.moveNumber=e.moveNumber)):(e.next=r,t.variationLevel=e.variationLevel)}(o,n,u),u},hasDiagramNag:function(t){return void 0!==t.nag&&null!=t.nag&&t.nag.indexOf("$220")>-1},PGN_NAGS:a,PROMOTIONS:{q:"queen",r:"rook",b:"bishop",n:"knight"},NAGS:u,san:l,sanWithNags:function(t){let n=l(t);return t.nag&&(n+=s(t.nag)),n},nagToSymbol:s,chess:e,loadPgn:f,possibleMoves:function(t){const n=new Map;return t.SQUARES.forEach((r=>{const e=t.moves({square:r,verbose:!0});e.length&&(n[r]=e.map((t=>t.to)))})),n},setShapes:function(t,n){t.commentDiag||(t.commentDiag={}),t.commentDiag.colorArrows=[],t.commentDiag.colorFields=[],n.forEach((n=>{if(n.dest){let r=n.brush.slice(0,1).toUpperCase(),e=n.orig+n.dest;t.commentDiag.colorArrows.push(r+e)}else{let r=n.brush.slice(0,1).toUpperCase(),e=n.orig;t.commentDiag.colorFields.push(r+e)}}))}}}})(),e})()}));
//# sourceMappingURL=pgn.js.map